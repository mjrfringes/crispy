
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Here we try to calculate the overlap fraction of two neighboring PSFs &#8212; crispy 0.2.0 documentation</title>
    <link rel="stylesheet" href="../_static/bootstrap-astropy.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.2.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../_static/sidebar.js"></script>
    <link rel="shortcut icon" href="../_static/astropy_logo.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
<link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:200,600' rel='stylesheet' type='text/css'/>
<script type="text/javascript" src="../_static/copybutton.js"></script>


  </head>
  <body>
<div class="topbar">
  <a class="brand" title="Documentation Home" href="../index.html"><span id="logotext1">CRIS</span><span id="logotext2">PY</span><span id="logotext3"> - IFS Simulator</span></a>
  <ul>
    <li><a class="homelink" title="Astropy Homepage" href="http://www.astropy.org"></a></li>
    <li><a title="General Index" href="../genindex.html">Index</a></li>
    <li><a title="Module Index" href="../py-modindex.html">Modules</a></li>
    <li>
      
      
<form action="../search.html" method="get">
  <input type="text" name="q" placeholder="Search" />
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
      
    </li>
  </ul>
</div>

<div class="related">
    <h3>Navigation</h3>
    <ul>
      <li>
	<a href="../index.html">crispy 0.2.0 documentation</a>
	 &#187;
      </li>
      
       
    </ul>
</div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput,
div.nbinput div.prompt,
div.nbinput div.input_area,
div.nbinput div[class*=highlight],
div.nbinput div[class*=highlight] pre,
div.nboutput,
div.nbinput div.prompt,
div.nbinput div.output_area,
div.nboutput div[class*=highlight],
div.nboutput div[class*=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput,
div.nboutput {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput,
    div.nboutput {
        flex-direction: column;
    }
}

/* input container */
div.nbinput {
    padding-top: 5px;
}

/* last container */
div.nblast {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput div.prompt pre {
    color: #303F9F;
}

/* output prompt */
div.nboutput div.prompt pre {
    color: #D84315;
}

/* all prompts */
div.nbinput div.prompt,
div.nboutput div.prompt {
    min-width: 9ex;
    padding-top: 0.4em;
    padding-right: 0.4em;
    text-align: right;
    flex: 0;
}
@media (max-width: 540px) {
    div.nbinput div.prompt,
    div.nboutput div.prompt {
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput div.prompt.empty {
        padding: 0;
    }
}

/* disable scrollbars on prompts */
div.nbinput div.prompt pre,
div.nboutput div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput div.input_area,
div.nboutput div.output_area {
    padding: 0.4em;
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput div.input_area,
    div.nboutput div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput div.input_area {
    border: 1px solid #cfcfcf;
    border-radius: 2px;
    background: #f7f7f7;
}

/* override MathJax center alignment in output cells */
div.nboutput div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.pngmath center alignment in output cells */
div.nboutput div.math p {
    text-align: left;
}

/* standard error */
div.nboutput div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }
</style>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [160]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">glob</span><span class="o">,</span><span class="nn">os</span>
<span class="o">%</span><span class="k">pylab</span> inline --no-import-all
<span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;font&#39;</span><span class="p">,</span> <span class="n">family</span><span class="o">=</span><span class="s1">&#39;serif&#39;</span><span class="p">,</span> <span class="n">serif</span><span class="o">=</span><span class="s1">&#39;Times&#39;</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;text&#39;</span><span class="p">,</span> <span class="n">usetex</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;xtick&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;xtick.major&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;ytick.major&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;ytick&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;axes&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;figure&#39;</span><span class="p">,</span><span class="n">titlesize</span><span class="o">=</span><span class="mi">25</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;image.origin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;lower&#39;</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;image.interpolation&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;nearest&#39;</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;axes.linewidth&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">2.</span>
<span class="kn">from</span> <span class="nn">astropy.io</span> <span class="kn">import</span> <span class="n">fits</span>

<span class="kn">import</span> <span class="nn">logging</span> <span class="kn">as</span> <span class="nn">log</span>
<span class="kn">from</span> <span class="nn">crispy.tools.initLogger</span> <span class="kn">import</span> <span class="n">getLogger</span>
<span class="n">log</span> <span class="o">=</span> <span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;main&#39;</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">crispy.tools.image</span> <span class="kn">import</span> <span class="n">Image</span>
<span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="s1">&#39;/Users/mrizzo/IFS/crispy/crispy/WFIRST/&#39;</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">params</span> <span class="kn">import</span> <span class="n">Params</span>
<span class="n">par</span> <span class="o">=</span> <span class="n">Params</span><span class="p">()</span>
<span class="n">par</span><span class="o">.</span><span class="n">hdr</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Populating the interactive namespace from numpy and matplotlib
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>Out[160]:
</pre></div>
</div>
<div class="output_area highlight-none"><div class="highlight"><pre>
<span></span>SIMPLE  =                    T / conforms to FITS standard
BITPIX  =                    8 / array data type
NAXIS   =                    0 / number of array dimensions
EXTEND  =                    T
COMMENT
COMMENT ************************************************************
COMMENT ********************** General parameters ******************
COMMENT ************************************************************
COMMENT
NLENS   =                  108 / # lenslets across array
PITCH   =             0.000174 / Lenslet pitch (meters)
INTERLAC=                  2.0 / Interlacing
PHILENS =    26.56505117707799 / Rotation angle of the lenslets (deg)
PIXSIZE =              1.3E-05 / Pixel size (meters)
LENSAMP =                  0.5 / Lenslet sampling (lam/D)
LSAMPWAV=                660.0 / Lenslet sampling wavelength (nm)
FWHM    =                  2.0 / FHWM of PSFLet at detector (pixels)
FWHMLAM =                660.0 / Wavelength at which FWHM is defined (nm)
NPIX    =                 1024 / Number of detector pixels
BW      =                 0.18 / Bandwidth
PIXPRLAM=                  2.0 / Pixels per resolution element
R       =                   50 / Spectral resolution
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [3]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="n">lensX</span><span class="o">=</span><span class="mi">10</span>
<span class="n">lensY</span><span class="o">=</span><span class="mi">10</span>

<span class="kn">from</span> <span class="nn">crispy.tools.locate_psflets</span> <span class="kn">import</span> <span class="n">PSFLets</span>
<span class="kn">from</span> <span class="nn">crispy.tools.reduction</span> <span class="kn">import</span> <span class="n">get_cutout</span>
<span class="n">polychromeR</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">par</span><span class="o">.</span><span class="n">wavecalDir</span> <span class="o">+</span> <span class="s1">&#39;polychromeR</span><span class="si">%d</span><span class="s1">.fits&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">par</span><span class="o">.</span><span class="n">R</span><span class="p">))</span>
<span class="n">psflets</span> <span class="o">=</span> <span class="n">polychromeR</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
<span class="n">psftool</span> <span class="o">=</span> <span class="n">PSFLets</span><span class="p">()</span>
<span class="n">lamlist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">par</span><span class="o">.</span><span class="n">wavecalDir</span> <span class="o">+</span> <span class="s2">&quot;lamsol.dat&quot;</span><span class="p">)[:,</span> <span class="mi">0</span><span class="p">]</span>
<span class="n">allcoef</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">par</span><span class="o">.</span><span class="n">wavecalDir</span> <span class="o">+</span> <span class="s2">&quot;lamsol.dat&quot;</span><span class="p">)[:,</span> <span class="mi">1</span><span class="p">:]</span>

<span class="c1"># lam in nm</span>
<span class="n">psftool</span><span class="o">.</span><span class="n">geninterparray</span><span class="p">(</span><span class="n">lamlist</span><span class="p">,</span> <span class="n">allcoef</span><span class="p">)</span>

<span class="n">xlist</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">ylist</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">lam</span> <span class="ow">in</span> <span class="n">lamlist</span><span class="p">:</span>
    <span class="n">_x</span><span class="p">,</span><span class="n">_y</span> <span class="o">=</span> <span class="n">psftool</span><span class="o">.</span><span class="n">return_locations</span><span class="p">(</span><span class="n">lam</span><span class="p">,</span> <span class="n">allcoef</span><span class="p">,</span> <span class="n">lensX</span><span class="p">,</span> <span class="n">lensY</span><span class="p">)</span>
    <span class="n">xlist</span> <span class="o">+=</span> <span class="p">[</span><span class="n">_x</span><span class="p">]</span>
    <span class="n">ylist</span> <span class="o">+=</span> <span class="p">[</span><span class="n">_y</span><span class="p">]</span>

<span class="n">im</span> <span class="o">=</span> <span class="n">Image</span><span class="p">(</span><span class="n">filename</span> <span class="o">=</span> <span class="n">par</span><span class="o">.</span><span class="n">wavecalDir</span> <span class="o">+</span> <span class="s1">&#39;polychromeR</span><span class="si">%d</span><span class="s1">stack.fits&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">par</span><span class="o">.</span><span class="n">R</span><span class="p">))</span>
<span class="n">subim</span><span class="p">,</span> <span class="n">psflet_subarr</span><span class="p">,</span> <span class="p">[</span><span class="n">x0</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">y1</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_cutout</span><span class="p">(</span><span class="n">im</span><span class="p">,</span><span class="n">xlist</span><span class="p">,</span><span class="n">ylist</span><span class="p">,</span><span class="n">psflets</span><span class="p">)</span>

</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
crispy - INFO - Read data from HDU 0 of ..//ReferenceFiles/wavecalR50_660/polychromeR50stack.fits
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [4]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">subim</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;horizontal&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>Out[4]:
</pre></div>
</div>
<div class="output_area highlight-none"><div class="highlight"><pre>
<span></span>&lt;matplotlib.colorbar.Colorbar at 0x1c1e69f450&gt;
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_SNR_Extraction_2_1.png" src="../_images/notebooks_SNR_Extraction_2_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [5]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="k">print</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">subim</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
119.967
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [6]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">psflet_subarr</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">psflet_subarr</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
    <span class="n">psflet_subarr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">psflet_subarr</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_SNR_Extraction_4_0.png" src="../_images/notebooks_SNR_Extraction_4_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [7]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="k">print</span> <span class="mf">1.</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">psflet_subarr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
9.63189459363
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [8]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="n">subim</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">psflet_subarr</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">subim</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;horizontal&#39;</span><span class="p">)</span>
<span class="k">print</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">subim</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
10.0
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_SNR_Extraction_6_1.png" src="../_images/notebooks_SNR_Extraction_6_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [281]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>Out[281]:
</pre></div>
</div>
<div class="output_area highlight-none"><div class="highlight"><pre>
<span></span>0.19446558720480406
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [176]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="n">Nelec</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">poisson</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">poisson</span><span class="p">(</span><span class="n">subim</span><span class="o">*</span><span class="n">Nelec</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [183]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">poisson</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;horizontal&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">subim</span><span class="o">*</span><span class="n">Nelec</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>Out[183]:
</pre></div>
</div>
<div class="output_area highlight-none"><div class="highlight"><pre>
<span></span>&lt;matplotlib.image.AxesImage at 0x1c251633d0&gt;
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_SNR_Extraction_9_1.png" src="../_images/notebooks_SNR_Extraction_9_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [177]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">crispy.IFS</span> <span class="kn">import</span> <span class="n">reduceIFSMap</span>
<span class="n">subim_flat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">poisson</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">psflets_flat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">psflet_subarr</span><span class="p">,</span> <span class="p">(</span><span class="n">psflet_subarr</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
<span class="n">coef</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">lstsq</span><span class="p">(</span><span class="n">psflets_flat</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">subim_flat</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">coef</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>Out[177]:
</pre></div>
</div>
<div class="output_area highlight-none"><div class="highlight"><pre>
<span></span>[&lt;matplotlib.lines.Line2D at 0x1c24186510&gt;]
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_SNR_Extraction_10_1.png" src="../_images/notebooks_SNR_Extraction_10_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [163]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="n">sumpsflets</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">subim</span><span class="o">*</span><span class="n">Nelec</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">subim_flat</span>
<span class="n">A</span> <span class="o">=</span> <span class="n">psflets_flat</span><span class="o">.</span><span class="n">T</span>
<span class="n">right</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">A</span><span class="p">),</span><span class="n">x</span><span class="p">)</span>
<span class="n">Cinv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">A</span><span class="p">),</span><span class="n">A</span><span class="p">)</span>
<span class="n">C</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">Cinv</span><span class="p">)</span>
<span class="n">coefs2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">left</span><span class="p">,</span><span class="n">right</span><span class="p">)</span>
<span class="k">print</span> <span class="n">coefs2</span>
<span class="k">print</span> <span class="n">coef</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">Cinv</span><span class="p">)</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[ 1029.07494861   879.24787784  1033.37495909  1000.32638945  1011.97641341
  1087.82293205   897.36978627  1060.88131053  1016.17029911   975.87481607]
[ 1029.07494861   879.24787784  1033.37495909  1000.32638945  1011.97641341
  1087.82293205   897.36978627  1060.88131053  1016.17029911   975.87481607]
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>Out[163]:
</pre></div>
</div>
<div class="output_area docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
      <th>5</th>
      <th>6</th>
      <th>7</th>
      <th>8</th>
      <th>9</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1.038217e-01</td>
      <td>3.781686e-02</td>
      <td>1.840839e-03</td>
      <td>1.013038e-05</td>
      <td>8.652204e-09</td>
      <td>4.499302e-08</td>
      <td>2.484550e-07</td>
      <td>2.281947e-07</td>
      <td>8.982292e-08</td>
      <td>2.520272e-07</td>
    </tr>
    <tr>
      <th>1</th>
      <td>3.781686e-02</td>
      <td>1.018298e-01</td>
      <td>3.907701e-02</td>
      <td>2.134296e-03</td>
      <td>1.585353e-05</td>
      <td>2.551539e-08</td>
      <td>6.033666e-08</td>
      <td>2.579995e-07</td>
      <td>3.781318e-07</td>
      <td>1.250960e-07</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1.840839e-03</td>
      <td>3.907701e-02</td>
      <td>9.909606e-02</td>
      <td>4.004341e-02</td>
      <td>2.592649e-03</td>
      <td>2.970352e-05</td>
      <td>5.567989e-08</td>
      <td>4.694419e-08</td>
      <td>3.752633e-07</td>
      <td>5.447811e-07</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1.013038e-05</td>
      <td>2.134296e-03</td>
      <td>4.004341e-02</td>
      <td>9.722045e-02</td>
      <td>4.058052e-02</td>
      <td>3.158885e-03</td>
      <td>4.540734e-05</td>
      <td>1.168523e-07</td>
      <td>5.635559e-08</td>
      <td>4.599480e-07</td>
    </tr>
    <tr>
      <th>4</th>
      <td>8.652204e-09</td>
      <td>1.585353e-05</td>
      <td>2.592649e-03</td>
      <td>4.058052e-02</td>
      <td>9.465773e-02</td>
      <td>4.112732e-02</td>
      <td>3.674209e-03</td>
      <td>6.368950e-05</td>
      <td>2.097110e-07</td>
      <td>7.582652e-08</td>
    </tr>
    <tr>
      <th>5</th>
      <td>4.499302e-08</td>
      <td>2.551539e-08</td>
      <td>2.970352e-05</td>
      <td>3.158885e-03</td>
      <td>4.112732e-02</td>
      <td>9.028060e-02</td>
      <td>4.157850e-02</td>
      <td>4.249863e-03</td>
      <td>9.927493e-05</td>
      <td>4.333803e-07</td>
    </tr>
    <tr>
      <th>6</th>
      <td>2.484550e-07</td>
      <td>6.033666e-08</td>
      <td>5.567989e-08</td>
      <td>4.540734e-05</td>
      <td>3.674209e-03</td>
      <td>4.157850e-02</td>
      <td>8.755923e-02</td>
      <td>4.206276e-02</td>
      <td>4.888705e-03</td>
      <td>1.282256e-04</td>
    </tr>
    <tr>
      <th>7</th>
      <td>2.281947e-07</td>
      <td>2.579995e-07</td>
      <td>4.694419e-08</td>
      <td>1.168523e-07</td>
      <td>6.368950e-05</td>
      <td>4.249863e-03</td>
      <td>4.206276e-02</td>
      <td>8.837557e-02</td>
      <td>4.320411e-02</td>
      <td>5.265365e-03</td>
    </tr>
    <tr>
      <th>8</th>
      <td>8.982292e-08</td>
      <td>3.781318e-07</td>
      <td>3.752633e-07</td>
      <td>5.635559e-08</td>
      <td>2.097110e-07</td>
      <td>9.927493e-05</td>
      <td>4.888705e-03</td>
      <td>4.320411e-02</td>
      <td>8.554713e-02</td>
      <td>4.410052e-02</td>
    </tr>
    <tr>
      <th>9</th>
      <td>2.520272e-07</td>
      <td>1.250960e-07</td>
      <td>5.447811e-07</td>
      <td>4.599480e-07</td>
      <td>7.582652e-08</td>
      <td>4.333803e-07</td>
      <td>1.282256e-04</td>
      <td>5.265365e-03</td>
      <td>4.410052e-02</td>
      <td>8.414933e-02</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [187]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="k">print</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">subim</span><span class="o">*</span><span class="n">Nelec</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="k">print</span> <span class="n">subim_flat</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[  8.36914584e-03   9.71942144e-02   1.24568967e+00   4.85315231e+00
   7.82761818e+00   8.78953079e+00   9.22344047e+00   9.75942182e+00
   1.03366595e+01   1.09537093e+01   1.17170004e+01   1.25887064e+01
   1.35931775e+01   1.47113787e+01   1.58049908e+01   1.67012367e+01
   1.71757125e+01   1.75870260e+01   1.80836216e+01   1.85913175e+01
   1.70223436e+01   1.03571405e+01   3.03675836e+00   3.48716876e-01
   1.56939391e-02   1.85383312e-02   1.11728846e+00   1.57654281e+01
   6.18381017e+01   9.67073310e+01   1.03351188e+02   1.06288370e+02
   1.07457127e+02   1.09200287e+02   1.11509701e+02   1.12948176e+02
   1.15380036e+02   1.17349923e+02   1.19332164e+02   1.21273726e+02
   1.22778742e+02   1.24271421e+02   1.27199067e+02   1.27159103e+02
   1.28022613e+02   1.13592655e+02   6.62721778e+01   1.90021625e+01
   2.15541932e+00   8.66642450e-02   4.64581259e-02   2.80660223e+00
   3.96828873e+01   1.55726811e+02   2.41016863e+02   2.52896074e+02
   2.57951116e+02   2.56449351e+02   2.56735322e+02   2.58729268e+02
   2.56679073e+02   2.57360271e+02   2.56251479e+02   2.54782997e+02
   2.53658246e+02   2.52691000e+02   2.54299501e+02   2.60492449e+02
   2.58084156e+02   2.58016757e+02   2.26195329e+02   1.29759063e+02
   3.68714503e+01   4.16854321e+00   1.67366384e-01   2.31166027e-02
   1.39235408e+00   1.96534506e+01   7.70765064e+01   1.20177152e+02
   1.27791925e+02   1.31090294e+02   1.31936102e+02   1.33538225e+02
   1.35880432e+02   1.36918932e+02   1.39216256e+02   1.40850905e+02
   1.42445327e+02   1.44042730e+02   1.45258200e+02   1.46798609e+02
   1.50246884e+02   1.49844881e+02   1.50575046e+02   1.33206324e+02
   7.74069884e+01   2.21479016e+01   2.51025731e+00   1.00901499e-01
   1.26798784e-02   1.48274888e-01   1.92868671e+00   7.52069585e+00
   1.20475846e+01   1.33942136e+01   1.39881314e+01   1.46675411e+01
   1.54106697e+01   1.62209964e+01   1.71949955e+01   1.83111671e+01
   1.95598765e+01   2.09364968e+01   2.22758844e+01   2.33642621e+01
   2.39534043e+01   2.45078783e+01   2.50601602e+01   2.56561868e+01
   2.33614783e+01   1.41168813e+01   4.12448682e+00   4.73325113e-01
   2.24295888e-02   7.98698388e-01   8.57091568e-01   8.61673468e-01
   6.88491663e-01   4.16676063e-01   3.15906599e-01   3.17086259e-01
   3.55162534e-01   3.98322692e-01   4.46126746e-01   5.13177764e-01
   5.90911397e-01   6.95041729e-01   8.21066062e-01   9.68871841e-01
   1.14002721e+00   1.25149034e+00   1.31435432e+00   1.41546319e+00
   1.51564530e+00   1.47881251e+00   1.05919094e+00   5.47445435e-01
   3.87928909e-01   4.31800794e-01]
[  0   0   0   5  13  13   9  10  12   7   8  13  13  13  18  16  18  26
  17  20  22  10   2   2   0   0   0  16  64  90 122 112  93 102 115  93
 111 111 122 128 122 117 125 116 148 123  59  26   0   0   0   1  42 151
 266 239 279 247 270 242 254 259 252 247 257 260 257 251 244 247 213 140
  40   0   1   0   1  16  90 115 149 148 145 139 145 132 140 145 137 155
 151 154 164 147 148 131  69  19   5   0   0   0   2   6   6   9  14  17
  18   9  17  11  20  22  30  25  20  26  23  23  15  22   6   0   0   0
   2   1   1   1   0   1   0   0   0   0   1   0   1   0   0   1   2   1
   1   5   2   0   1   1]
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [194]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="n">sumpsflets</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">subim</span><span class="o">*</span><span class="n">Nelec</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">subim_flat</span>
<span class="n">A</span> <span class="o">=</span> <span class="n">psflets_flat</span><span class="o">.</span><span class="n">T</span>
<span class="n">Ninv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">sumpsflets</span><span class="p">))</span>
<span class="n">right</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">A</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Ninv</span><span class="p">,</span><span class="n">x</span><span class="p">))</span>
<span class="n">Cinv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">A</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Ninv</span><span class="p">,</span><span class="n">A</span><span class="p">))</span>
<span class="n">C</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">Cinv</span><span class="p">)</span>
<span class="n">coefs2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">C</span><span class="p">,</span><span class="n">right</span><span class="p">)</span>
<span class="k">print</span> <span class="n">coefs2</span>
<span class="k">print</span> <span class="n">coef</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">coefs2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">coef</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">Cinv</span><span class="p">)</span>
<span class="n">df</span>

</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[ 1009.69949343  1082.5808662   1004.90373994   947.97632249   977.80226055
  1004.96213425  1045.63562269   996.39692379   957.57649455  1021.46614213]
[ 1029.41823826  1055.36635742  1011.03572279   957.09061157  1001.41691338
   974.09039007  1063.13357213   976.65161888   956.23135385  1002.07668355]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>Out[194]:
</pre></div>
</div>
<div class="output_area docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
      <th>5</th>
      <th>6</th>
      <th>7</th>
      <th>8</th>
      <th>9</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>7.734472e-04</td>
      <td>2.157569e-04</td>
      <td>1.015925e-05</td>
      <td>5.566459e-08</td>
      <td>2.388645e-09</td>
      <td>3.760930e-08</td>
      <td>1.326292e-07</td>
      <td>1.090138e-07</td>
      <td>5.624654e-08</td>
      <td>2.430884e-07</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2.157569e-04</td>
      <td>5.585638e-04</td>
      <td>2.135959e-04</td>
      <td>1.162064e-05</td>
      <td>8.647409e-08</td>
      <td>1.094544e-09</td>
      <td>2.859788e-08</td>
      <td>1.174503e-07</td>
      <td>1.509469e-07</td>
      <td>7.810491e-08</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1.015925e-05</td>
      <td>2.135959e-04</td>
      <td>5.433293e-04</td>
      <td>2.181984e-04</td>
      <td>1.415082e-05</td>
      <td>1.644270e-07</td>
      <td>1.144279e-09</td>
      <td>2.049863e-08</td>
      <td>1.491961e-07</td>
      <td>2.309696e-07</td>
    </tr>
    <tr>
      <th>3</th>
      <td>5.566459e-08</td>
      <td>1.162064e-05</td>
      <td>2.181984e-04</td>
      <td>5.302746e-04</td>
      <td>2.218581e-04</td>
      <td>1.743905e-05</td>
      <td>2.507104e-07</td>
      <td>1.135271e-09</td>
      <td>2.505959e-08</td>
      <td>2.765784e-07</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2.388645e-09</td>
      <td>8.647409e-08</td>
      <td>1.415082e-05</td>
      <td>2.218581e-04</td>
      <td>5.168332e-04</td>
      <td>2.264001e-04</td>
      <td>2.023953e-05</td>
      <td>3.500155e-07</td>
      <td>2.217204e-09</td>
      <td>7.705220e-08</td>
    </tr>
    <tr>
      <th>5</th>
      <td>3.760930e-08</td>
      <td>1.094544e-09</td>
      <td>1.644270e-07</td>
      <td>1.743905e-05</td>
      <td>2.264001e-04</td>
      <td>5.006253e-04</td>
      <td>2.311844e-04</td>
      <td>2.358952e-05</td>
      <td>5.499433e-07</td>
      <td>8.529147e-09</td>
    </tr>
    <tr>
      <th>6</th>
      <td>1.326292e-07</td>
      <td>2.859788e-08</td>
      <td>1.144279e-09</td>
      <td>2.507104e-07</td>
      <td>2.023953e-05</td>
      <td>2.311844e-04</td>
      <td>4.880761e-04</td>
      <td>2.324718e-04</td>
      <td>2.691534e-05</td>
      <td>6.998262e-07</td>
    </tr>
    <tr>
      <th>7</th>
      <td>1.090138e-07</td>
      <td>1.174503e-07</td>
      <td>2.049863e-08</td>
      <td>1.135271e-09</td>
      <td>3.500155e-07</td>
      <td>2.358952e-05</td>
      <td>2.324718e-04</td>
      <td>4.795250e-04</td>
      <td>2.350915e-04</td>
      <td>2.872404e-05</td>
    </tr>
    <tr>
      <th>8</th>
      <td>5.624654e-08</td>
      <td>1.509469e-07</td>
      <td>1.491961e-07</td>
      <td>2.505959e-08</td>
      <td>2.217204e-09</td>
      <td>5.499433e-07</td>
      <td>2.691534e-05</td>
      <td>2.350915e-04</td>
      <td>4.743217e-04</td>
      <td>2.627378e-04</td>
    </tr>
    <tr>
      <th>9</th>
      <td>2.430884e-07</td>
      <td>7.810491e-08</td>
      <td>2.309696e-07</td>
      <td>2.765784e-07</td>
      <td>7.705220e-08</td>
      <td>8.529147e-09</td>
      <td>6.998262e-07</td>
      <td>2.872404e-05</td>
      <td>2.627378e-04</td>
      <td>7.069240e-04</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_SNR_Extraction_13_2.png" src="../_images/notebooks_SNR_Extraction_13_2.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [195]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">scipy</span> <span class="kn">as</span> <span class="nn">sp</span>
<span class="n">Q</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">sqrtm</span><span class="p">(</span><span class="n">Cinv</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">Q</span><span class="p">)</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>Out[195]:
</pre></div>
</div>
<div class="output_area docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
      <th>5</th>
      <th>6</th>
      <th>7</th>
      <th>8</th>
      <th>9</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2.747264e-02</td>
      <td>4.318693e-03</td>
      <td>-2.179829e-04</td>
      <td>0.000050</td>
      <td>-0.000013</td>
      <td>0.000005</td>
      <td>0.000001</td>
      <td>2.277440e-06</td>
      <td>1.163512e-08</td>
      <td>4.542546e-06</td>
    </tr>
    <tr>
      <th>1</th>
      <td>4.318693e-03</td>
      <td>2.273227e-02</td>
      <td>4.802638e-03</td>
      <td>-0.000293</td>
      <td>0.000072</td>
      <td>-0.000020</td>
      <td>0.000007</td>
      <td>-1.299198e-07</td>
      <td>3.622440e-06</td>
      <td>3.294230e-07</td>
    </tr>
    <tr>
      <th>2</th>
      <td>-2.179829e-04</td>
      <td>4.802638e-03</td>
      <td>2.224853e-02</td>
      <td>0.005013</td>
      <td>-0.000289</td>
      <td>0.000076</td>
      <td>-0.000023</td>
      <td>7.413944e-06</td>
      <td>2.079646e-07</td>
      <td>4.499250e-06</td>
    </tr>
    <tr>
      <th>3</th>
      <td>5.032201e-05</td>
      <td>-2.926043e-04</td>
      <td>5.012935e-03</td>
      <td>0.021864</td>
      <td>0.005189</td>
      <td>-0.000267</td>
      <td>0.000080</td>
      <td>-2.426958e-05</td>
      <td>7.348341e-06</td>
      <td>3.478876e-06</td>
    </tr>
    <tr>
      <th>4</th>
      <td>-1.339374e-05</td>
      <td>7.154025e-05</td>
      <td>-2.888467e-04</td>
      <td>0.005189</td>
      <td>0.021460</td>
      <td>0.005405</td>
      <td>-0.000264</td>
      <td>8.161484e-05</td>
      <td>-2.441367e-05</td>
      <td>6.603404e-06</td>
    </tr>
    <tr>
      <th>5</th>
      <td>4.591565e-06</td>
      <td>-2.032603e-05</td>
      <td>7.625768e-05</td>
      <td>-0.000267</td>
      <td>0.005405</td>
      <td>0.020965</td>
      <td>0.005634</td>
      <td>-2.346800e-04</td>
      <td>7.725068e-05</td>
      <td>-1.681522e-05</td>
    </tr>
    <tr>
      <th>6</th>
      <td>1.077780e-06</td>
      <td>6.741974e-06</td>
      <td>-2.287725e-05</td>
      <td>0.000080</td>
      <td>-0.000264</td>
      <td>0.005634</td>
      <td>0.020572</td>
      <td>5.746442e-03</td>
      <td>-1.822801e-04</td>
      <td>5.266418e-05</td>
    </tr>
    <tr>
      <th>7</th>
      <td>2.277440e-06</td>
      <td>-1.299198e-07</td>
      <td>7.413944e-06</td>
      <td>-0.000024</td>
      <td>0.000082</td>
      <td>-0.000235</td>
      <td>0.005746</td>
      <td>2.030361e-02</td>
      <td>5.847476e-03</td>
      <td>-1.069790e-04</td>
    </tr>
    <tr>
      <th>8</th>
      <td>1.163512e-08</td>
      <td>3.622440e-06</td>
      <td>2.079646e-07</td>
      <td>0.000007</td>
      <td>-0.000024</td>
      <td>0.000077</td>
      <td>-0.000182</td>
      <td>5.847476e-03</td>
      <td>2.018732e-02</td>
      <td>5.706236e-03</td>
    </tr>
    <tr>
      <th>9</th>
      <td>4.542546e-06</td>
      <td>3.294230e-07</td>
      <td>4.499250e-06</td>
      <td>0.000003</td>
      <td>0.000007</td>
      <td>-0.000017</td>
      <td>0.000053</td>
      <td>-1.069790e-04</td>
      <td>5.706236e-03</td>
      <td>2.596822e-02</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [274]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">Q</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>Out[274]:
</pre></div>
</div>
<div class="output_area highlight-none"><div class="highlight"><pre>
<span></span>0.031622776601683916
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [276]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">Q</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="k">print</span> <span class="n">s</span>
<span class="n">R</span> <span class="o">=</span> <span class="n">Q</span><span class="o">/</span><span class="n">s</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,:]</span>
<span class="n">Ctilde_inv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">s</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="n">Ctilde</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">R</span><span class="p">,</span><span class="n">C</span><span class="p">),</span><span class="n">R</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
<span class="c1"># eigvec,R = np.linalg.eig(Cinv)</span>
<span class="c1"># print eigvec</span>
<span class="c1"># Ctildeinv = np.diag(eigvec)</span>
<span class="c1"># Cinv_check = np.dot(R,np.dot(Ctildeinv,R.T))</span>
<span class="c1"># Ctilde = np.linalg.inv(Ctildeinv)</span>
<span class="c1"># pd.DataFrame(data=Cinv_check)</span>
<span class="k">print</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">R</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">R</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
<span class="k">print</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">coefs2</span><span class="p">)</span>
<span class="k">print</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">R</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">coefs2</span><span class="p">))</span>
<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">R</span><span class="p">)</span>



</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[ 0.03162278  0.03162278  0.03162278  0.03162278  0.03162278  0.03162278
  0.03162278  0.03162278  0.03162278  0.03162278]
1.0
3180.01850514
3178.99792594
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>Out[276]:
</pre></div>
</div>
<div class="output_area docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
      <th>5</th>
      <th>6</th>
      <th>7</th>
      <th>8</th>
      <th>9</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>8.687611e-01</td>
      <td>0.136569</td>
      <td>-0.006893</td>
      <td>0.001591</td>
      <td>-0.000424</td>
      <td>0.000145</td>
      <td>0.000034</td>
      <td>0.000072</td>
      <td>3.679347e-07</td>
      <td>0.000144</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1.365691e-01</td>
      <td>0.718858</td>
      <td>0.151873</td>
      <td>-0.009253</td>
      <td>0.002262</td>
      <td>-0.000643</td>
      <td>0.000213</td>
      <td>-0.000004</td>
      <td>1.145516e-04</td>
      <td>0.000010</td>
    </tr>
    <tr>
      <th>2</th>
      <td>-6.893223e-03</td>
      <td>0.151873</td>
      <td>0.703560</td>
      <td>0.158523</td>
      <td>-0.009134</td>
      <td>0.002411</td>
      <td>-0.000723</td>
      <td>0.000234</td>
      <td>6.576418e-06</td>
      <td>0.000142</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1.591322e-03</td>
      <td>-0.009253</td>
      <td>0.158523</td>
      <td>0.691416</td>
      <td>0.164080</td>
      <td>-0.008455</td>
      <td>0.002523</td>
      <td>-0.000767</td>
      <td>2.323749e-04</td>
      <td>0.000110</td>
    </tr>
    <tr>
      <th>4</th>
      <td>-4.235471e-04</td>
      <td>0.002262</td>
      <td>-0.009134</td>
      <td>0.164080</td>
      <td>0.678622</td>
      <td>0.170932</td>
      <td>-0.008356</td>
      <td>0.002581</td>
      <td>-7.720279e-04</td>
      <td>0.000209</td>
    </tr>
    <tr>
      <th>5</th>
      <td>1.451980e-04</td>
      <td>-0.000643</td>
      <td>0.002411</td>
      <td>-0.008455</td>
      <td>0.170932</td>
      <td>0.662972</td>
      <td>0.178148</td>
      <td>-0.007421</td>
      <td>2.442881e-03</td>
      <td>-0.000532</td>
    </tr>
    <tr>
      <th>6</th>
      <td>3.408239e-05</td>
      <td>0.000213</td>
      <td>-0.000723</td>
      <td>0.002523</td>
      <td>-0.008356</td>
      <td>0.178148</td>
      <td>0.650542</td>
      <td>0.181718</td>
      <td>-5.764203e-03</td>
      <td>0.001665</td>
    </tr>
    <tr>
      <th>7</th>
      <td>7.201898e-05</td>
      <td>-0.000004</td>
      <td>0.000234</td>
      <td>-0.000767</td>
      <td>0.002581</td>
      <td>-0.007421</td>
      <td>0.181718</td>
      <td>0.642057</td>
      <td>1.849134e-01</td>
      <td>-0.003383</td>
    </tr>
    <tr>
      <th>8</th>
      <td>3.679347e-07</td>
      <td>0.000115</td>
      <td>0.000007</td>
      <td>0.000232</td>
      <td>-0.000772</td>
      <td>0.002443</td>
      <td>-0.005764</td>
      <td>0.184913</td>
      <td>6.383790e-01</td>
      <td>0.180447</td>
    </tr>
    <tr>
      <th>9</th>
      <td>1.436479e-04</td>
      <td>0.000010</td>
      <td>0.000142</td>
      <td>0.000110</td>
      <td>0.000209</td>
      <td>-0.000532</td>
      <td>0.001665</td>
      <td>-0.003383</td>
      <td>1.804470e-01</td>
      <td>0.821187</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [197]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">Cinv</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>Out[197]:
</pre></div>
</div>
<div class="output_area docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
      <th>5</th>
      <th>6</th>
      <th>7</th>
      <th>8</th>
      <th>9</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>7.734472e-04</td>
      <td>2.157569e-04</td>
      <td>1.015925e-05</td>
      <td>5.566459e-08</td>
      <td>2.388645e-09</td>
      <td>3.760930e-08</td>
      <td>1.326292e-07</td>
      <td>1.090138e-07</td>
      <td>5.624654e-08</td>
      <td>2.430884e-07</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2.157569e-04</td>
      <td>5.585638e-04</td>
      <td>2.135959e-04</td>
      <td>1.162064e-05</td>
      <td>8.647409e-08</td>
      <td>1.094544e-09</td>
      <td>2.859788e-08</td>
      <td>1.174503e-07</td>
      <td>1.509469e-07</td>
      <td>7.810491e-08</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1.015925e-05</td>
      <td>2.135959e-04</td>
      <td>5.433293e-04</td>
      <td>2.181984e-04</td>
      <td>1.415082e-05</td>
      <td>1.644270e-07</td>
      <td>1.144279e-09</td>
      <td>2.049863e-08</td>
      <td>1.491961e-07</td>
      <td>2.309696e-07</td>
    </tr>
    <tr>
      <th>3</th>
      <td>5.566459e-08</td>
      <td>1.162064e-05</td>
      <td>2.181984e-04</td>
      <td>5.302746e-04</td>
      <td>2.218581e-04</td>
      <td>1.743905e-05</td>
      <td>2.507104e-07</td>
      <td>1.135271e-09</td>
      <td>2.505959e-08</td>
      <td>2.765784e-07</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2.388645e-09</td>
      <td>8.647409e-08</td>
      <td>1.415082e-05</td>
      <td>2.218581e-04</td>
      <td>5.168332e-04</td>
      <td>2.264001e-04</td>
      <td>2.023953e-05</td>
      <td>3.500155e-07</td>
      <td>2.217204e-09</td>
      <td>7.705220e-08</td>
    </tr>
    <tr>
      <th>5</th>
      <td>3.760930e-08</td>
      <td>1.094544e-09</td>
      <td>1.644270e-07</td>
      <td>1.743905e-05</td>
      <td>2.264001e-04</td>
      <td>5.006253e-04</td>
      <td>2.311844e-04</td>
      <td>2.358952e-05</td>
      <td>5.499433e-07</td>
      <td>8.529147e-09</td>
    </tr>
    <tr>
      <th>6</th>
      <td>1.326292e-07</td>
      <td>2.859788e-08</td>
      <td>1.144279e-09</td>
      <td>2.507104e-07</td>
      <td>2.023953e-05</td>
      <td>2.311844e-04</td>
      <td>4.880761e-04</td>
      <td>2.324718e-04</td>
      <td>2.691534e-05</td>
      <td>6.998262e-07</td>
    </tr>
    <tr>
      <th>7</th>
      <td>1.090138e-07</td>
      <td>1.174503e-07</td>
      <td>2.049863e-08</td>
      <td>1.135271e-09</td>
      <td>3.500155e-07</td>
      <td>2.358952e-05</td>
      <td>2.324718e-04</td>
      <td>4.795250e-04</td>
      <td>2.350915e-04</td>
      <td>2.872404e-05</td>
    </tr>
    <tr>
      <th>8</th>
      <td>5.624654e-08</td>
      <td>1.509469e-07</td>
      <td>1.491961e-07</td>
      <td>2.505959e-08</td>
      <td>2.217204e-09</td>
      <td>5.499433e-07</td>
      <td>2.691534e-05</td>
      <td>2.350915e-04</td>
      <td>4.743217e-04</td>
      <td>2.627378e-04</td>
    </tr>
    <tr>
      <th>9</th>
      <td>2.430884e-07</td>
      <td>7.810491e-08</td>
      <td>2.309696e-07</td>
      <td>2.765784e-07</td>
      <td>7.705220e-08</td>
      <td>8.529147e-09</td>
      <td>6.998262e-07</td>
      <td>2.872404e-05</td>
      <td>2.627378e-04</td>
      <td>7.069240e-04</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [198]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">Ctilde</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>Out[198]:
</pre></div>
</div>
<div class="output_area docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
      <th>5</th>
      <th>6</th>
      <th>7</th>
      <th>8</th>
      <th>9</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1.000000e+03</td>
      <td>1.084007e-12</td>
      <td>1.566886e-12</td>
      <td>1.973644e-12</td>
      <td>4.704766e-13</td>
      <td>4.424441e-13</td>
      <td>2.410884e-13</td>
      <td>2.062135e-13</td>
      <td>-4.402034e-13</td>
      <td>4.405920e-13</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1.193874e-12</td>
      <td>1.000000e+03</td>
      <td>4.465956e-13</td>
      <td>-4.328951e-13</td>
      <td>1.238365e-12</td>
      <td>3.927543e-13</td>
      <td>-2.459259e-13</td>
      <td>9.425893e-13</td>
      <td>1.362799e-12</td>
      <td>5.048739e-13</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1.614585e-12</td>
      <td>3.954041e-13</td>
      <td>1.000000e+03</td>
      <td>-3.943976e-14</td>
      <td>7.756921e-15</td>
      <td>-3.256844e-13</td>
      <td>8.850875e-13</td>
      <td>-8.340411e-14</td>
      <td>3.250733e-13</td>
      <td>5.933032e-13</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1.980524e-12</td>
      <td>-4.376654e-13</td>
      <td>-9.869702e-14</td>
      <td>1.000000e+03</td>
      <td>-5.522832e-13</td>
      <td>7.454553e-13</td>
      <td>7.034309e-13</td>
      <td>5.352422e-13</td>
      <td>2.042810e-14</td>
      <td>4.836131e-13</td>
    </tr>
    <tr>
      <th>4</th>
      <td>4.743130e-13</td>
      <td>1.237227e-12</td>
      <td>-1.214769e-13</td>
      <td>-6.334758e-13</td>
      <td>1.000000e+03</td>
      <td>1.993751e-12</td>
      <td>-4.876598e-13</td>
      <td>2.353952e-12</td>
      <td>1.215028e-12</td>
      <td>1.912248e-12</td>
    </tr>
    <tr>
      <th>5</th>
      <td>4.438471e-13</td>
      <td>4.027736e-13</td>
      <td>-2.712018e-13</td>
      <td>7.028230e-13</td>
      <td>1.971726e-12</td>
      <td>1.000000e+03</td>
      <td>-1.748890e-14</td>
      <td>7.322187e-13</td>
      <td>2.842171e-13</td>
      <td>-9.237056e-14</td>
    </tr>
    <tr>
      <th>6</th>
      <td>2.416984e-13</td>
      <td>-2.363970e-13</td>
      <td>8.816225e-13</td>
      <td>6.891675e-13</td>
      <td>-4.950891e-13</td>
      <td>-1.384378e-13</td>
      <td>1.000000e+03</td>
      <td>-4.588506e-13</td>
      <td>-3.126388e-13</td>
      <td>-6.181722e-13</td>
    </tr>
    <tr>
      <th>7</th>
      <td>2.053900e-13</td>
      <td>9.448034e-13</td>
      <td>-8.125549e-14</td>
      <td>5.560882e-13</td>
      <td>2.358866e-12</td>
      <td>8.205061e-13</td>
      <td>-3.870634e-13</td>
      <td>1.000000e+03</td>
      <td>3.410605e-13</td>
      <td>-4.263256e-13</td>
    </tr>
    <tr>
      <th>8</th>
      <td>-4.401859e-13</td>
      <td>1.362754e-12</td>
      <td>3.309383e-13</td>
      <td>2.070794e-14</td>
      <td>1.254560e-12</td>
      <td>2.071758e-13</td>
      <td>-3.130328e-13</td>
      <td>3.154448e-13</td>
      <td>1.000000e+03</td>
      <td>4.547474e-13</td>
    </tr>
    <tr>
      <th>9</th>
      <td>4.407484e-13</td>
      <td>5.047325e-13</td>
      <td>5.944053e-13</td>
      <td>4.857925e-13</td>
      <td>1.920158e-12</td>
      <td>-9.832259e-14</td>
      <td>-5.997332e-13</td>
      <td>-5.061070e-13</td>
      <td>3.410605e-13</td>
      <td>1.000000e+03</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [199]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">R</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>Out[199]:
</pre></div>
</div>
<div class="output_area docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
      <th>5</th>
      <th>6</th>
      <th>7</th>
      <th>8</th>
      <th>9</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>8.687611e-01</td>
      <td>0.136569</td>
      <td>-0.006893</td>
      <td>0.001591</td>
      <td>-0.000424</td>
      <td>0.000145</td>
      <td>0.000034</td>
      <td>0.000072</td>
      <td>3.679347e-07</td>
      <td>0.000144</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1.365691e-01</td>
      <td>0.718858</td>
      <td>0.151873</td>
      <td>-0.009253</td>
      <td>0.002262</td>
      <td>-0.000643</td>
      <td>0.000213</td>
      <td>-0.000004</td>
      <td>1.145516e-04</td>
      <td>0.000010</td>
    </tr>
    <tr>
      <th>2</th>
      <td>-6.893223e-03</td>
      <td>0.151873</td>
      <td>0.703560</td>
      <td>0.158523</td>
      <td>-0.009134</td>
      <td>0.002411</td>
      <td>-0.000723</td>
      <td>0.000234</td>
      <td>6.576418e-06</td>
      <td>0.000142</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1.591322e-03</td>
      <td>-0.009253</td>
      <td>0.158523</td>
      <td>0.691416</td>
      <td>0.164080</td>
      <td>-0.008455</td>
      <td>0.002523</td>
      <td>-0.000767</td>
      <td>2.323749e-04</td>
      <td>0.000110</td>
    </tr>
    <tr>
      <th>4</th>
      <td>-4.235471e-04</td>
      <td>0.002262</td>
      <td>-0.009134</td>
      <td>0.164080</td>
      <td>0.678622</td>
      <td>0.170932</td>
      <td>-0.008356</td>
      <td>0.002581</td>
      <td>-7.720279e-04</td>
      <td>0.000209</td>
    </tr>
    <tr>
      <th>5</th>
      <td>1.451980e-04</td>
      <td>-0.000643</td>
      <td>0.002411</td>
      <td>-0.008455</td>
      <td>0.170932</td>
      <td>0.662972</td>
      <td>0.178148</td>
      <td>-0.007421</td>
      <td>2.442881e-03</td>
      <td>-0.000532</td>
    </tr>
    <tr>
      <th>6</th>
      <td>3.408239e-05</td>
      <td>0.000213</td>
      <td>-0.000723</td>
      <td>0.002523</td>
      <td>-0.008356</td>
      <td>0.178148</td>
      <td>0.650542</td>
      <td>0.181718</td>
      <td>-5.764203e-03</td>
      <td>0.001665</td>
    </tr>
    <tr>
      <th>7</th>
      <td>7.201898e-05</td>
      <td>-0.000004</td>
      <td>0.000234</td>
      <td>-0.000767</td>
      <td>0.002581</td>
      <td>-0.007421</td>
      <td>0.181718</td>
      <td>0.642057</td>
      <td>1.849134e-01</td>
      <td>-0.003383</td>
    </tr>
    <tr>
      <th>8</th>
      <td>3.679347e-07</td>
      <td>0.000115</td>
      <td>0.000007</td>
      <td>0.000232</td>
      <td>-0.000772</td>
      <td>0.002443</td>
      <td>-0.005764</td>
      <td>0.184913</td>
      <td>6.383790e-01</td>
      <td>0.180447</td>
    </tr>
    <tr>
      <th>9</th>
      <td>1.436479e-04</td>
      <td>0.000010</td>
      <td>0.000142</td>
      <td>0.000110</td>
      <td>0.000209</td>
      <td>-0.000532</td>
      <td>0.001665</td>
      <td>-0.003383</td>
      <td>1.804470e-01</td>
      <td>0.821187</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [200]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="n">ftilde</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">R</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">coefs2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [201]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ftilde</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">coefs2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>Out[201]:
</pre></div>
</div>
<div class="output_area highlight-none"><div class="highlight"><pre>
<span></span>[&lt;matplotlib.lines.Line2D at 0x1c256f3850&gt;]
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_SNR_Extraction_21_1.png" src="../_images/notebooks_SNR_Extraction_21_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [202]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="n">res</span> <span class="o">=</span> <span class="n">poisson</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">A</span><span class="p">,</span><span class="n">ftilde</span><span class="p">),</span><span class="n">subim</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;horizontal&#39;</span><span class="p">)</span>
<span class="k">print</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">res</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
6158.30269334
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_SNR_Extraction_22_1.png" src="../_images/notebooks_SNR_Extraction_22_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [205]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="n">res</span> <span class="o">=</span> <span class="n">poisson</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">A</span><span class="p">,</span><span class="n">coef</span><span class="p">),</span><span class="n">subim</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;horizontal&#39;</span><span class="p">)</span>
<span class="k">print</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">res</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
5983.40627738
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_SNR_Extraction_23_1.png" src="../_images/notebooks_SNR_Extraction_23_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [79]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">Ctilde</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>Out[79]:
</pre></div>
</div>
<div class="output_area docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
      <th>5</th>
      <th>6</th>
      <th>7</th>
      <th>8</th>
      <th>9</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1.000000e+03</td>
      <td>1.047164e-12</td>
      <td>1.542670e-12</td>
      <td>1.991906e-12</td>
      <td>4.865038e-13</td>
      <td>4.442494e-13</td>
      <td>2.420484e-13</td>
      <td>2.050090e-13</td>
      <td>-4.404810e-13</td>
      <td>4.401479e-13</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1.183358e-12</td>
      <td>1.000000e+03</td>
      <td>3.873132e-13</td>
      <td>-4.613495e-13</td>
      <td>1.164422e-12</td>
      <td>3.901602e-13</td>
      <td>-2.500752e-13</td>
      <td>9.494771e-13</td>
      <td>1.362466e-12</td>
      <td>5.052070e-13</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1.591648e-12</td>
      <td>3.043960e-13</td>
      <td>1.000000e+03</td>
      <td>6.667713e-14</td>
      <td>2.702058e-13</td>
      <td>-3.383922e-13</td>
      <td>8.948923e-13</td>
      <td>-9.800312e-14</td>
      <td>3.308465e-13</td>
      <td>5.939693e-13</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1.999778e-12</td>
      <td>-4.935485e-13</td>
      <td>-5.824559e-14</td>
      <td>1.000000e+03</td>
      <td>-6.077263e-13</td>
      <td>4.119348e-13</td>
      <td>7.892916e-13</td>
      <td>5.280457e-13</td>
      <td>3.641532e-14</td>
      <td>4.818368e-13</td>
    </tr>
    <tr>
      <th>4</th>
      <td>4.862728e-13</td>
      <td>1.164545e-12</td>
      <td>1.641657e-13</td>
      <td>-7.136695e-13</td>
      <td>1.000000e+03</td>
      <td>1.764369e-12</td>
      <td>-3.280897e-13</td>
      <td>2.212372e-12</td>
      <td>1.261213e-12</td>
      <td>1.908695e-12</td>
    </tr>
    <tr>
      <th>5</th>
      <td>4.475986e-13</td>
      <td>4.012577e-13</td>
      <td>-2.678575e-13</td>
      <td>3.837688e-13</td>
      <td>1.915488e-12</td>
      <td>1.000000e+03</td>
      <td>1.867192e-13</td>
      <td>9.082254e-13</td>
      <td>3.268497e-13</td>
      <td>-1.154632e-13</td>
    </tr>
    <tr>
      <th>6</th>
      <td>2.419082e-13</td>
      <td>-2.423133e-13</td>
      <td>8.931239e-13</td>
      <td>7.634229e-13</td>
      <td>-2.714065e-13</td>
      <td>7.857264e-14</td>
      <td>1.000000e+03</td>
      <td>-4.708012e-13</td>
      <td>-4.831691e-13</td>
      <td>-5.329071e-13</td>
    </tr>
    <tr>
      <th>7</th>
      <td>2.044334e-13</td>
      <td>9.502762e-13</td>
      <td>-9.851634e-14</td>
      <td>5.561742e-13</td>
      <td>2.221975e-12</td>
      <td>9.333929e-13</td>
      <td>-3.687920e-13</td>
      <td>1.000000e+03</td>
      <td>2.842171e-13</td>
      <td>-4.973799e-13</td>
    </tr>
    <tr>
      <th>8</th>
      <td>-4.399681e-13</td>
      <td>1.360916e-12</td>
      <td>3.353250e-13</td>
      <td>3.126327e-14</td>
      <td>1.292535e-12</td>
      <td>2.305231e-13</td>
      <td>-4.308748e-13</td>
      <td>3.055963e-13</td>
      <td>1.000000e+03</td>
      <td>5.115908e-13</td>
    </tr>
    <tr>
      <th>9</th>
      <td>4.407388e-13</td>
      <td>5.050290e-13</td>
      <td>5.937839e-13</td>
      <td>4.820915e-13</td>
      <td>1.916001e-12</td>
      <td>-1.087304e-13</td>
      <td>-5.294150e-13</td>
      <td>-5.481175e-13</td>
      <td>3.979039e-13</td>
      <td>1.000000e+03</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [78]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">R</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Ctilde_inv</span><span class="p">,</span><span class="n">R</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>Out[78]:
</pre></div>
</div>
<div class="output_area docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
      <th>5</th>
      <th>6</th>
      <th>7</th>
      <th>8</th>
      <th>9</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>7.734472e-04</td>
      <td>2.157569e-04</td>
      <td>1.015925e-05</td>
      <td>5.566459e-08</td>
      <td>2.388645e-09</td>
      <td>3.760930e-08</td>
      <td>1.326292e-07</td>
      <td>1.090138e-07</td>
      <td>5.624654e-08</td>
      <td>2.430884e-07</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2.157569e-04</td>
      <td>5.585638e-04</td>
      <td>2.135959e-04</td>
      <td>1.162064e-05</td>
      <td>8.647409e-08</td>
      <td>1.094544e-09</td>
      <td>2.859788e-08</td>
      <td>1.174503e-07</td>
      <td>1.509469e-07</td>
      <td>7.810491e-08</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1.015925e-05</td>
      <td>2.135959e-04</td>
      <td>5.433293e-04</td>
      <td>2.181984e-04</td>
      <td>1.415082e-05</td>
      <td>1.644270e-07</td>
      <td>1.144279e-09</td>
      <td>2.049863e-08</td>
      <td>1.491961e-07</td>
      <td>2.309696e-07</td>
    </tr>
    <tr>
      <th>3</th>
      <td>5.566459e-08</td>
      <td>1.162064e-05</td>
      <td>2.181984e-04</td>
      <td>5.302746e-04</td>
      <td>2.218581e-04</td>
      <td>1.743905e-05</td>
      <td>2.507104e-07</td>
      <td>1.135271e-09</td>
      <td>2.505959e-08</td>
      <td>2.765784e-07</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2.388645e-09</td>
      <td>8.647409e-08</td>
      <td>1.415082e-05</td>
      <td>2.218581e-04</td>
      <td>5.168332e-04</td>
      <td>2.264001e-04</td>
      <td>2.023953e-05</td>
      <td>3.500155e-07</td>
      <td>2.217204e-09</td>
      <td>7.705220e-08</td>
    </tr>
    <tr>
      <th>5</th>
      <td>3.760930e-08</td>
      <td>1.094544e-09</td>
      <td>1.644270e-07</td>
      <td>1.743905e-05</td>
      <td>2.264001e-04</td>
      <td>5.006253e-04</td>
      <td>2.311844e-04</td>
      <td>2.358952e-05</td>
      <td>5.499433e-07</td>
      <td>8.529147e-09</td>
    </tr>
    <tr>
      <th>6</th>
      <td>1.326292e-07</td>
      <td>2.859788e-08</td>
      <td>1.144279e-09</td>
      <td>2.507104e-07</td>
      <td>2.023953e-05</td>
      <td>2.311844e-04</td>
      <td>4.880761e-04</td>
      <td>2.324718e-04</td>
      <td>2.691534e-05</td>
      <td>6.998262e-07</td>
    </tr>
    <tr>
      <th>7</th>
      <td>1.090138e-07</td>
      <td>1.174503e-07</td>
      <td>2.049863e-08</td>
      <td>1.135271e-09</td>
      <td>3.500155e-07</td>
      <td>2.358952e-05</td>
      <td>2.324718e-04</td>
      <td>4.795250e-04</td>
      <td>2.350915e-04</td>
      <td>2.872404e-05</td>
    </tr>
    <tr>
      <th>8</th>
      <td>5.624654e-08</td>
      <td>1.509469e-07</td>
      <td>1.491961e-07</td>
      <td>2.505959e-08</td>
      <td>2.217204e-09</td>
      <td>5.499433e-07</td>
      <td>2.691534e-05</td>
      <td>2.350915e-04</td>
      <td>4.743217e-04</td>
      <td>2.627378e-04</td>
    </tr>
    <tr>
      <th>9</th>
      <td>2.430884e-07</td>
      <td>7.810491e-08</td>
      <td>2.309696e-07</td>
      <td>2.765784e-07</td>
      <td>7.705220e-08</td>
      <td>8.529147e-09</td>
      <td>6.998262e-07</td>
      <td>2.872404e-05</td>
      <td>2.627378e-04</td>
      <td>7.069240e-04</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [98]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="n">subim</span> <span class="o">=</span> <span class="n">psflet_subarr</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="c1">#np.sum(psflet_subarr,axis=0)</span>
<span class="c1"># subim = np.sum(psflet_subarr,axis=0)</span>
<span class="n">sumpsflets</span> <span class="o">=</span> <span class="n">subim</span><span class="o">+</span><span class="mf">1e-10</span>
<span class="n">Nelec</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">Niter</span> <span class="o">=</span> <span class="mi">10000</span>
<span class="n">vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">10</span><span class="p">,</span><span class="n">Niter</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Niter</span><span class="p">):</span>
    <span class="n">poisson</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">poisson</span><span class="p">(</span><span class="n">subim</span><span class="o">*</span><span class="n">Nelec</span><span class="p">)</span>
    <span class="n">subim_flat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">poisson</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">sumpsflets</span><span class="p">),</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">psflets_flat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">psflet_subarr</span><span class="p">,</span> <span class="p">(</span><span class="n">psflet_subarr</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">sumpsflets_flat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">sumpsflets</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">vals</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">lstsq</span><span class="p">(</span><span class="n">psflets_flat</span><span class="o">.</span><span class="n">T</span><span class="o">/</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">sumpsflets_flat</span><span class="p">[:,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">])),</span> <span class="n">subim_flat</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">estSNR</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">vals</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">vals</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">poisson</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">estSNR</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;SNR&#39;</span><span class="p">)</span>
<span class="k">print</span> <span class="s2">&quot;Expected SNR:&quot;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">Nelec</span><span class="p">)</span>
<span class="k">print</span> <span class="s2">&quot;Estimated SNR:&quot;</span><span class="p">,</span><span class="n">estSNR</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">vals</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Extraction results&#39;</span><span class="p">)</span>

<span class="k">print</span> <span class="s1">&#39;Mean:&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">vals</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
<span class="k">print</span> <span class="s1">&#39;Std:&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">vals</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Expected SNR: 31.6227766017
Estimated SNR: 30.9676343937
Mean: 999.641133786
Std: 32.280190378
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_SNR_Extraction_26_1.png" src="../_images/notebooks_SNR_Extraction_26_1.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_SNR_Extraction_26_2.png" src="../_images/notebooks_SNR_Extraction_26_2.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_SNR_Extraction_26_3.png" src="../_images/notebooks_SNR_Extraction_26_3.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [76]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="n">subim</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,:]</span><span class="o">.</span><span class="n">shape</span>
<span class="n">psflets_flat</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>Out[76]:
</pre></div>
</div>
<div class="output_area highlight-none"><div class="highlight"><pre>
<span></span>(150, 10)
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [360]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="n">pixnoise</span><span class="o">=</span><span class="mi">0</span>
<span class="n">Niter</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">amax</span><span class="p">((</span><span class="n">subim</span><span class="o">*</span><span class="n">Nelec</span><span class="o">+</span><span class="n">pixnoise</span><span class="p">)</span><span class="o">/</span><span class="mf">0.1</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<span class="k">print</span> <span class="n">Niter</span>
<span class="n">img</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">subim</span><span class="p">)</span>
<span class="n">var</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">subim</span><span class="p">)</span>
<span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Niter</span><span class="p">):</span>
    <span class="n">frame</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">poisson</span><span class="p">((</span><span class="n">subim</span><span class="o">*</span><span class="n">Nelec</span><span class="o">+</span><span class="n">pixnoise</span><span class="p">)</span><span class="o">/</span><span class="n">Niter</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">))</span>
    <span class="n">img</span><span class="o">+=</span> <span class="n">frame</span>
    <span class="n">var</span> <span class="o">+=</span> <span class="n">frame</span><span class="o">**</span><span class="mi">2</span>
<span class="n">var</span> <span class="o">/=</span> <span class="n">Niter</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
<span class="n">var</span> <span class="o">-=</span> <span class="p">(</span><span class="n">img</span><span class="o">/</span><span class="n">Niter</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span>
<span class="n">var</span><span class="o">*=</span><span class="n">Niter</span>

</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
1988
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [363]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="c1"># plt.imshow(np.sum(img,axis=0))</span>
<span class="c1"># plt.colorbar(orientation=&#39;horizontal&#39;)</span>
<span class="c1"># plt.figure()</span>
<span class="c1"># plt.imshow(Niter*np.std(img,axis=0)**2)</span>
<span class="c1"># plt.colorbar(orientation=&#39;horizontal&#39;)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;horizontal&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">var</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;horizontal&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>Out[363]:
</pre></div>
</div>
<div class="output_area highlight-none"><div class="highlight"><pre>
<span></span>&lt;matplotlib.colorbar.Colorbar at 0x1c26faa250&gt;
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_SNR_Extraction_29_1.png" src="../_images/notebooks_SNR_Extraction_29_1.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_SNR_Extraction_29_2.png" src="../_images/notebooks_SNR_Extraction_29_2.png" />
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [283]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="c1"># subim = psflet_subarr[3]+psflet_subarr[4]+psflet_subarr[5]</span>
<span class="c1"># sumpsflets = psflet_subarr[3]+psflet_subarr[4]+psflet_subarr[5]+1e-10</span>
<span class="k">def</span> <span class="nf">calcSNR</span><span class="p">(</span><span class="n">Nelec</span><span class="p">,</span><span class="n">subim</span><span class="p">,</span><span class="n">psflet_subarr</span><span class="p">,</span><span class="n">pixnoise</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">npix</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">Niter</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span><span class="n">plot</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="c1">#sumpsflets = subim*Nelec+pixnoise+1e-10</span>
    <span class="n">vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">10</span><span class="p">,</span><span class="n">Niter</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Niter</span><span class="p">):</span>
        <span class="c1"># subtract mean of background (assumed known)</span>
        <span class="n">Niter</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">amax</span><span class="p">((</span><span class="n">subim</span><span class="o">*</span><span class="n">Nelec</span><span class="o">+</span><span class="n">pixnoise</span><span class="p">)</span><span class="o">/</span><span class="mf">0.1</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        <span class="k">print</span> <span class="n">Niter</span>
        <span class="n">img</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">subim</span><span class="p">)</span>
        <span class="n">var</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">subim</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Niter</span><span class="p">):</span>
            <span class="n">frame</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">poisson</span><span class="p">((</span><span class="n">subim</span><span class="o">*</span><span class="n">Nelec</span><span class="o">+</span><span class="n">pixnoise</span><span class="p">)</span><span class="o">/</span><span class="n">Niter</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">))</span>
            <span class="n">img</span><span class="o">+=</span> <span class="n">frame</span>
            <span class="n">var</span> <span class="o">+=</span> <span class="n">frame</span><span class="o">**</span><span class="mi">2</span>
        <span class="n">var</span> <span class="o">/=</span> <span class="n">Niter</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">var</span> <span class="o">-=</span> <span class="p">(</span><span class="n">img</span><span class="o">/</span><span class="n">Niter</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span>
        <span class="n">img</span> <span class="o">-=</span> <span class="n">pixnoise</span>



        <span class="n">img</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">poisson</span><span class="p">(</span><span class="n">subim</span><span class="o">*</span><span class="n">Nelec</span><span class="p">)</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">poisson</span><span class="p">(</span><span class="n">pixnoise</span><span class="p">,</span><span class="n">subim</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span><span class="o">-</span><span class="n">pixnoise</span>
<span class="c1">#         subim_flat = np.reshape(img/np.sqrt(sumpsflets), -1)</span>
<span class="c1">#         psflets_flat = np.reshape(psflet_subarr, (psflet_subarr.shape[0], -1))</span>
<span class="c1">#         sumpsflets_flat = np.reshape(sumpsflets,-1)</span>
<span class="c1">#         vals[:,i] = np.linalg.lstsq(psflets_flat.T/(np.sqrt(sumpsflets_flat[:,np.newaxis])), subim_flat)[0]</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">img</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">psflets_flat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">psflet_subarr</span><span class="p">,</span> <span class="p">(</span><span class="n">psflet_subarr</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
        <span class="n">variance</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">img</span><span class="o">+</span><span class="n">pixnoise</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">A</span> <span class="o">=</span> <span class="n">psflets_flat</span><span class="o">.</span><span class="n">T</span>
        <span class="n">Ninv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">variance</span><span class="p">))</span>
        <span class="n">right</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">A</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Ninv</span><span class="p">,</span><span class="n">x</span><span class="p">))</span>
        <span class="n">Cinv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">A</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Ninv</span><span class="p">,</span><span class="n">A</span><span class="p">))</span>
        <span class="n">C</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">Cinv</span><span class="p">)</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">C</span><span class="p">,</span><span class="n">right</span><span class="p">)</span>
        <span class="n">Q</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">sqrtm</span><span class="p">(</span><span class="n">Cinv</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">Q</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">R</span> <span class="o">=</span> <span class="n">Q</span><span class="o">/</span><span class="n">s</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,:]</span>
        <span class="n">Ctilde_inv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">s</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">Ctilde</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">R</span><span class="p">,</span><span class="n">C</span><span class="p">),</span><span class="n">R</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
        <span class="n">vals</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">R</span><span class="p">,</span><span class="n">f</span><span class="p">)</span>

    <span class="n">estSNR</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">vals</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">vals</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;horizontal&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">estSNR</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;SNR&#39;</span><span class="p">)</span>
        <span class="n">SNR</span> <span class="o">=</span> <span class="n">Nelec</span><span class="o">/</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">Nelec</span><span class="o">+</span><span class="n">npix</span><span class="o">*</span><span class="n">pixnoise</span><span class="p">))</span>
        <span class="k">print</span> <span class="s2">&quot;Expected SNR:&quot;</span><span class="p">,</span><span class="n">SNR</span>
        <span class="k">print</span> <span class="s2">&quot;Estimated SNR:&quot;</span><span class="p">,</span><span class="n">estSNR</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
        <span class="k">print</span> <span class="s2">&quot;Change:&quot;</span><span class="p">,</span><span class="mi">100</span><span class="o">*</span><span class="p">(</span><span class="n">SNR</span><span class="o">-</span><span class="n">estSNR</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span><span class="o">/</span><span class="n">SNR</span><span class="p">,</span><span class="s2">&quot;%&quot;</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">vals</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Extraction results&#39;</span><span class="p">)</span>

        <span class="k">print</span> <span class="s1">&#39;Mean:&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">vals</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
        <span class="k">print</span> <span class="s1">&#39;Std:&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">vals</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">estSNR</span><span class="p">,</span><span class="n">vals</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [156]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="n">Nelec</span> <span class="o">=</span> <span class="mi">1000</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [284]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="n">subim</span> <span class="o">=</span> <span class="n">psflet_subarr</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
<span class="n">calcSNR</span><span class="p">(</span><span class="n">Nelec</span><span class="o">=</span><span class="n">Nelec</span><span class="p">,</span>
        <span class="n">subim</span><span class="o">=</span><span class="n">subim</span><span class="p">,</span>
        <span class="n">psflet_subarr</span><span class="o">=</span><span class="n">psflet_subarr</span><span class="p">,</span>
        <span class="n">pixnoise</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">npix</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">plot</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Expected SNR: 31.6227766017
Estimated SNR: 28.6672219085
Change: 9.3462845795 %
Mean: 658.346664578
Std: 22.965136513
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>Out[284]:
</pre></div>
</div>
<div class="output_area highlight-none"><div class="highlight"><pre>
<span></span>(array([ -6.69609382,   6.17600137,  -3.09012777,  26.77403156,
         28.66722191,  20.85799043,  -2.59840071,  10.17968289,
        -14.52433335,  15.9369054 ]),
 array([[ -0.98727645,  -1.23838786,  -1.5672904 , ...,  -1.17845905,
          -1.18490278,  -1.08900126],
        [  3.03780782,   4.33055175,   5.03513058, ...,   3.77195768,
           3.7365447 ,   3.46632474],
        [ -5.10280313, -11.58715201, -11.81517458, ...,  -7.79158495,
          -7.40714042,  -7.22177143],
        ...,
        [  4.90337577,   3.59649249,   4.46750672, ...,   4.05217952,
           4.20042556,   4.04761129],
        [ -2.25780475,  -1.72025209,  -2.20662132, ...,  -2.13536533,
          -2.02757096,  -1.94594523],
        [  0.87330208,   0.70774927,   0.87771375, ...,   0.83781596,
           0.84501627,   0.77734313]]))
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_SNR_Extraction_32_2.png" src="../_images/notebooks_SNR_Extraction_32_2.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_SNR_Extraction_32_3.png" src="../_images/notebooks_SNR_Extraction_32_3.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_SNR_Extraction_32_4.png" src="../_images/notebooks_SNR_Extraction_32_4.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [98]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="n">subim</span> <span class="o">=</span> <span class="n">psflet_subarr</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">+</span><span class="n">psflet_subarr</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">+</span><span class="n">psflet_subarr</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
<span class="n">calcSNR</span><span class="p">(</span><span class="n">Nelec</span><span class="o">=</span><span class="n">Nelec</span><span class="p">,</span>
        <span class="n">subim</span><span class="o">=</span><span class="n">subim</span><span class="p">,</span>
        <span class="n">psflet_subarr</span><span class="o">=</span><span class="n">psflet_subarr</span><span class="p">,</span>
        <span class="n">pixnoise</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">npix</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">plot</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Expected SNR: 31.6227766017
Estimated SNR: 30.2364911003
Change: 4.38381967158 %
Mean: 965.720605249
Std: 31.938911233
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>Out[98]:
</pre></div>
</div>
<div class="output_area highlight-none"><div class="highlight"><pre>
<span></span>array([  4.41647161e-03,   3.61707089e-01,   2.22621102e+01,
         3.20128514e+01,   3.02364911e+01,   3.19807643e+01,
         2.30514677e+01,   8.38364765e-01,  -1.40290249e-02,
         3.04891060e-02])
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_SNR_Extraction_33_2.png" src="../_images/notebooks_SNR_Extraction_33_2.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_SNR_Extraction_33_3.png" src="../_images/notebooks_SNR_Extraction_33_3.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_SNR_Extraction_33_4.png" src="../_images/notebooks_SNR_Extraction_33_4.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [292]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="n">vect</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">psflet_subarr</span><span class="o">*</span><span class="n">vect</span><span class="p">[:,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>Out[292]:
</pre></div>
</div>
<div class="output_area highlight-none"><div class="highlight"><pre>
<span></span>&lt;matplotlib.image.AxesImage at 0x1c279b6a10&gt;
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_SNR_Extraction_34_1.png" src="../_images/notebooks_SNR_Extraction_34_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [293]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="n">subim</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">psflet_subarr</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">subim</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">psflet_subarr</span><span class="o">*</span><span class="n">vect</span><span class="p">[:,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">est</span><span class="p">,</span><span class="n">vals</span> <span class="o">=</span> <span class="n">calcSNR</span><span class="p">(</span><span class="n">Nelec</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
        <span class="n">subim</span><span class="o">=</span><span class="n">subim</span><span class="p">,</span>
        <span class="n">psflet_subarr</span><span class="o">=</span><span class="n">psflet_subarr</span><span class="p">,</span>
        <span class="n">pixnoise</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">npix</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">plot</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>


</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Expected SNR: 31.6227766017
Estimated SNR: 26.6210210663
Change: 15.8169397912 %
Mean: 617.077255466
Std: 23.1800746459
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_SNR_Extraction_35_1.png" src="../_images/notebooks_SNR_Extraction_35_1.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_SNR_Extraction_35_2.png" src="../_images/notebooks_SNR_Extraction_35_2.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_SNR_Extraction_35_3.png" src="../_images/notebooks_SNR_Extraction_35_3.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [207]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">vals</span><span class="p">[:,</span><span class="mi">500</span><span class="p">:</span><span class="mi">510</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>Out[207]:
</pre></div>
</div>
<div class="output_area highlight-none"><div class="highlight"><pre>
<span></span>[&lt;matplotlib.lines.Line2D at 0x10e693bd0&gt;,
 &lt;matplotlib.lines.Line2D at 0x10e693c90&gt;,
 &lt;matplotlib.lines.Line2D at 0x10e693d50&gt;,
 &lt;matplotlib.lines.Line2D at 0x10e693e10&gt;,
 &lt;matplotlib.lines.Line2D at 0x10e693ed0&gt;,
 &lt;matplotlib.lines.Line2D at 0x10e693f90&gt;,
 &lt;matplotlib.lines.Line2D at 0x10e6a0090&gt;,
 &lt;matplotlib.lines.Line2D at 0x10e6a0150&gt;,
 &lt;matplotlib.lines.Line2D at 0x10e6a0210&gt;,
 &lt;matplotlib.lines.Line2D at 0x10e6a02d0&gt;]
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_SNR_Extraction_36_1.png" src="../_images/notebooks_SNR_Extraction_36_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [172]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="n">subim</span> <span class="o">=</span> <span class="n">psflet_subarr</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
<span class="n">calcSNR</span><span class="p">(</span><span class="n">Nelec</span><span class="o">=</span><span class="n">Nelec</span><span class="p">,</span>
        <span class="n">subim</span><span class="o">=</span><span class="n">subim</span><span class="p">,</span>
        <span class="n">psflet_subarr</span><span class="o">=</span><span class="n">psflet_subarr</span><span class="p">,</span>
        <span class="n">pixnoise</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
        <span class="n">npix</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
        <span class="n">plot</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Expected SNR: 9.53462589246
Estimated SNR: 6.88169078276
Change: 27.8242181667 %
Mean: 1000.24890453
Std: 145.349295124
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>Out[172]:
</pre></div>
</div>
<div class="output_area highlight-none"><div class="highlight"><pre>
<span></span>array([ -1.16564273e-02,   9.98796925e-03,  -1.34675929e-02,
        -1.03571127e-02,   6.88169078e+00,   1.23015588e-02,
         3.05834008e-03,  -8.97785608e-03,   1.35429766e-02,
        -1.03598799e-02])
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_SNR_Extraction_37_2.png" src="../_images/notebooks_SNR_Extraction_37_2.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_SNR_Extraction_37_3.png" src="../_images/notebooks_SNR_Extraction_37_3.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_SNR_Extraction_37_4.png" src="../_images/notebooks_SNR_Extraction_37_4.png" />
</div>
</div>
<p>This is the main function that suggests that an npix of ~6 is
appropriate for the regime we are in (&lt;1000 electrons)</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [208]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="n">noiselist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1000</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span>  <span class="c1"># mean number of electrons from background</span>
<span class="n">estvals</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">compvals</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">npix</span> <span class="o">=</span> <span class="mi">6</span>
<span class="n">Nelec</span><span class="o">=</span><span class="mi">2000</span>
<span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">noiselist</span><span class="p">:</span>
<span class="c1">#     subim = psflet_subarr[4]</span>
    <span class="n">subim</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">psflet_subarr</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">estSNR</span> <span class="o">=</span> <span class="n">calcSNR</span><span class="p">(</span><span class="n">Nelec</span><span class="o">=</span><span class="n">Nelec</span><span class="p">,</span>
        <span class="n">subim</span><span class="o">=</span><span class="n">subim</span><span class="p">,</span>
        <span class="n">psflet_subarr</span><span class="o">=</span><span class="n">psflet_subarr</span><span class="p">,</span>
        <span class="n">pixnoise</span><span class="o">=</span><span class="n">val</span><span class="p">,</span>
        <span class="n">npix</span><span class="o">=</span><span class="n">npix</span><span class="p">,</span>
        <span class="n">plot</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    <span class="n">estvals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">estSNR</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
    <span class="n">compvals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Nelec</span><span class="o">/</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">Nelec</span><span class="o">+</span><span class="n">npix</span><span class="o">*</span><span class="n">val</span><span class="p">)))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">noiselist</span><span class="p">,</span><span class="n">estvals</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">noiselist</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">compvals</span><span class="p">)</span><span class="o">*</span><span class="mf">0.54</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>Out[208]:
</pre></div>
</div>
<div class="output_area highlight-none"><div class="highlight"><pre>
<span></span>[&lt;matplotlib.lines.Line2D at 0x10e301950&gt;]
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_SNR_Extraction_39_1.png" src="../_images/notebooks_SNR_Extraction_39_1.png" />
</div>
</div>
<div class="section" id="Here-we-try-to-calculate-the-overlap-fraction-of-two-neighboring-PSFs">
<h1>Here we try to calculate the overlap fraction of two neighboring PSFs<a class="headerlink" href="#Here-we-try-to-calculate-the-overlap-fraction-of-two-neighboring-PSFs" title="Permalink to this headline"></a></h1>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [188]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">psflet_subarr</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">*</span><span class="n">psflet_subarr</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">+</span><span class="n">psflet_subarr</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">*</span><span class="n">psflet_subarr</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>Out[188]:
</pre></div>
</div>
<div class="output_area highlight-none"><div class="highlight"><pre>
<span></span>0.081430537510390921
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [191]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">psflet_subarr</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">psflet_subarr</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>

</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>Out[191]:
</pre></div>
</div>
<div class="output_area highlight-none"><div class="highlight"><pre>
<span></span>&lt;matplotlib.image.AxesImage at 0x10deb90d0&gt;
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_SNR_Extraction_42_1.png" src="../_images/notebooks_SNR_Extraction_42_1.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_SNR_Extraction_42_2.png" src="../_images/notebooks_SNR_Extraction_42_2.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [204]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="k">print</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">psflet_subarr</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span><span class="n">psflet_subarr</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">psflet_subarr</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span><span class="n">psflet_subarr</span><span class="p">[</span><span class="mi">6</span><span class="p">]))</span>
<span class="n">val</span><span class="o">=</span><span class="mi">0</span>
<span class="n">img</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">subim</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">i</span><span class="o">!=</span><span class="mi">4</span><span class="p">:</span>
        <span class="n">img</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">psflet_subarr</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span><span class="n">psflet_subarr</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="n">val</span><span class="o">+=</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">psflet_subarr</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span><span class="n">psflet_subarr</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
<span class="k">print</span> <span class="n">val</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>

</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0.402294711401
0.810877565754
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>Out[204]:
</pre></div>
</div>
<div class="output_area highlight-none"><div class="highlight"><pre>
<span></span>&lt;matplotlib.colorbar.Colorbar at 0x10e97abd0&gt;
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_SNR_Extraction_43_2.png" src="../_images/notebooks_SNR_Extraction_43_2.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [2]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">crispy.unitTests</span> <span class="kn">import</span> <span class="n">testOptExt</span>
<span class="n">im</span> <span class="o">=</span> <span class="n">Image</span><span class="p">(</span><span class="n">filename</span> <span class="o">=</span> <span class="n">par</span><span class="o">.</span><span class="n">wavecalDir</span> <span class="o">+</span> <span class="s1">&#39;polychromeR</span><span class="si">%d</span><span class="s1">stack.fits&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">par</span><span class="o">.</span><span class="n">R</span><span class="p">))</span>
<span class="n">spec</span><span class="p">,</span><span class="n">var</span> <span class="o">=</span> <span class="n">testOptExt</span><span class="p">(</span><span class="n">par</span><span class="p">,</span><span class="n">im</span><span class="p">,</span><span class="mi">54</span><span class="p">,</span><span class="mi">54</span><span class="p">,</span><span class="n">smoothandmask</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
crispy - INFO - Read data from HDU 0 of ..//ReferenceFiles/wavecalR50_660/polychromeR50stack.fits
crispy - INFO - Reduced cube will have 19 wavelength bins
crispy - WARNING - No PSFLet widths found - assuming critical samping at central wavelength
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [5]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>Out[5]:
</pre></div>
</div>
<div class="output_area highlight-none"><div class="highlight"><pre>
<span></span>[&lt;matplotlib.lines.Line2D at 0x1c0a9bb310&gt;]
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_SNR_Extraction_45_1.png" src="../_images/notebooks_SNR_Extraction_45_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [116]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">crispy.tools.locate_psflets</span> <span class="kn">import</span> <span class="n">PSFLets</span>
<span class="n">PSFlet_tool</span> <span class="o">=</span> <span class="n">PSFLets</span><span class="p">(</span><span class="n">load</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">infiledir</span><span class="o">=</span><span class="n">par</span><span class="o">.</span><span class="n">wavecalDir</span><span class="p">)</span>
<span class="n">i</span><span class="o">=</span><span class="mi">54</span>
<span class="n">j</span><span class="o">=</span><span class="mi">54</span>
<span class="n">xindx</span> <span class="o">=</span> <span class="n">PSFlet_tool</span><span class="o">.</span><span class="n">xindx</span>
<span class="n">yindx</span> <span class="o">=</span> <span class="n">PSFlet_tool</span><span class="o">.</span><span class="n">yindx</span>
<span class="n">Nmax</span> <span class="o">=</span> <span class="n">PSFlet_tool</span><span class="o">.</span><span class="n">nlam_max</span>


<span class="n">_x</span> <span class="o">=</span> <span class="n">xindx</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="p">:</span><span class="n">PSFlet_tool</span><span class="o">.</span><span class="n">nlam</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]]</span>
<span class="n">_y</span> <span class="o">=</span> <span class="n">yindx</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="p">:</span><span class="n">PSFlet_tool</span><span class="o">.</span><span class="n">nlam</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]]</span>
<span class="n">_lam</span> <span class="o">=</span> <span class="n">PSFlet_tool</span><span class="o">.</span><span class="n">lam_indx</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="p">:</span><span class="n">PSFlet_tool</span><span class="o">.</span><span class="n">nlam</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]]</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">_x</span><span class="o">-</span><span class="n">y0</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="n">Y</span> <span class="o">=</span> <span class="n">_y</span><span class="o">-</span><span class="n">x0</span>
<span class="n">Y</span> <span class="o">=</span> <span class="n">Y</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="n">lam</span> <span class="o">=</span> <span class="n">_lam</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="k">print</span> <span class="n">X</span><span class="p">,</span><span class="n">Y</span><span class="p">,</span><span class="n">_lam</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[  0.   1.   2.   3.   4.   5.   6.   7.   8.   9.  10.  11.  12.  13.  14.
  15.  16.  17.  18.  19.  20.  21.  22.  23.  24.  25.] [ 2.48430467  2.4846161   2.48488505  2.48511378  2.48530457  2.48545978
  2.48558134  2.48567283  2.4857371   2.48577668  2.48579567  2.48579714
  2.48578521  2.48576374  2.48573718  2.48571006  2.48568725  2.48567393
  2.48567578  2.48569841  2.485748    2.48583112  2.48595499  2.48612681
  2.48635425  2.48664551] [ 576.74744611  582.56776822  588.44268775  594.37264881  600.35835049
  606.40062819  612.50047722  618.66004432  624.87883289  631.15786097
  637.49968826  643.90332588  650.37139018  656.90367092  663.50229484
  670.16694683  676.90053916  683.70230327  690.57396904  697.51721008
  704.53206937  711.61970547  718.78123942  726.01815774  733.33105824
  740.72074028  748.18813204  755.7341012 ]
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [117]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="n">subim</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">psflet_subarr</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">subim</span><span class="o">*=</span><span class="mi">1000</span>
<span class="n">spec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">subim</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">subim_res</span> <span class="o">=</span> <span class="n">subim</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">sig</span> <span class="o">=</span> <span class="mf">2.</span><span class="o">/</span><span class="mf">2.35</span><span class="o">*</span><span class="n">lam</span><span class="o">/</span><span class="n">par</span><span class="o">.</span><span class="n">FWHMlam</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">Y</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">subim</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
    <span class="n">weights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">subim</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">-</span><span class="n">y</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="mf">2.</span><span class="o">/</span><span class="n">sig</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="n">sig</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
    <span class="n">spec</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">subim</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">weights</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">weights</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">subim_res</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span> <span class="o">-=</span> <span class="n">spec</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">weights</span>
    <span class="k">print</span> <span class="n">spec</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0.0446018525614
3.27742529873
57.1886856588
267.776676199
464.059651946
503.382148237
517.63097062
520.938413141
524.682808036
534.528985074
535.782353331
542.845373307
547.14135606
550.165539601
554.385271925
557.797197134
563.948038094
580.779276101
582.289961553
586.381659471
538.023559796
337.269050645
108.522932829
14.2039514417
0.670589282647
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [120]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">subim</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;horizontal&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>Out[120]:
</pre></div>
</div>
<div class="output_area highlight-none"><div class="highlight"><pre>
<span></span>&lt;matplotlib.colorbar.Colorbar at 0x1c1739d710&gt;
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_SNR_Extraction_48_1.png" src="../_images/notebooks_SNR_Extraction_48_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [119]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">subim_res</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;horizontal&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>Out[119]:
</pre></div>
</div>
<div class="output_area highlight-none"><div class="highlight"><pre>
<span></span>&lt;matplotlib.colorbar.Colorbar at 0x1c1707ac90&gt;
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_SNR_Extraction_49_1.png" src="../_images/notebooks_SNR_Extraction_49_1.png" />
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [200]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">crispy.tools.locate_psflets</span> <span class="kn">import</span> <span class="n">PSFLets</span>

<span class="k">def</span> <span class="nf">calcSNROptExt</span><span class="p">(</span><span class="n">Nelec</span><span class="p">,</span><span class="n">subim</span><span class="p">,</span><span class="n">pixnoise</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">npix</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">Niter</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span><span class="n">plot</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="n">PSFlet_tool</span> <span class="o">=</span> <span class="n">PSFLets</span><span class="p">(</span><span class="n">load</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">infiledir</span><span class="o">=</span><span class="n">par</span><span class="o">.</span><span class="n">wavecalDir</span><span class="p">)</span>
    <span class="n">xindx</span> <span class="o">=</span> <span class="n">PSFlet_tool</span><span class="o">.</span><span class="n">xindx</span>
    <span class="n">yindx</span> <span class="o">=</span> <span class="n">PSFlet_tool</span><span class="o">.</span><span class="n">yindx</span>
    <span class="n">Nmax</span> <span class="o">=</span> <span class="n">PSFlet_tool</span><span class="o">.</span><span class="n">nlam_max</span>

    <span class="n">i</span><span class="o">=</span><span class="n">lensX</span><span class="o">+</span><span class="mi">54</span>
    <span class="n">j</span><span class="o">=</span><span class="n">lensY</span><span class="o">+</span><span class="mi">54</span>
    <span class="n">_x</span> <span class="o">=</span> <span class="n">xindx</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="p">:</span><span class="n">PSFlet_tool</span><span class="o">.</span><span class="n">nlam</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]]</span>
    <span class="n">_y</span> <span class="o">=</span> <span class="n">yindx</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="p">:</span><span class="n">PSFlet_tool</span><span class="o">.</span><span class="n">nlam</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]]</span>
    <span class="n">_lam</span> <span class="o">=</span> <span class="n">PSFlet_tool</span><span class="o">.</span><span class="n">lam_indx</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="p">:</span><span class="n">PSFlet_tool</span><span class="o">.</span><span class="n">nlam</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]]</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">_x</span><span class="o">-</span><span class="n">y0</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">Y</span> <span class="o">=</span> <span class="n">_y</span><span class="o">-</span><span class="n">x0</span>
    <span class="n">Y</span> <span class="o">=</span> <span class="n">Y</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">lam</span> <span class="o">=</span> <span class="n">_lam</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="n">vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">subim</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">Niter</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Niter</span><span class="p">):</span>
        <span class="c1"># subtract mean of background (assumed known)</span>
        <span class="n">img</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">poisson</span><span class="p">(</span><span class="n">subim</span><span class="o">*</span><span class="n">Nelec</span><span class="p">)</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">poisson</span><span class="p">(</span><span class="n">pixnoise</span><span class="p">,</span><span class="n">subim</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span><span class="o">-</span><span class="n">pixnoise</span>
        <span class="n">spec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">subim</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">sig</span> <span class="o">=</span> <span class="mf">2.</span><span class="o">/</span><span class="mf">2.35</span><span class="o">*</span><span class="n">lam</span><span class="o">/</span><span class="n">par</span><span class="o">.</span><span class="n">FWHMlam</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">Y</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
            <span class="n">weights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">-</span><span class="n">y</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="mf">2.</span><span class="o">/</span><span class="n">sig</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="n">sig</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
            <span class="n">vals</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">img</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">weights</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">weights</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">estSNR</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">vals</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">vals</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">estSNR_central</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">vals</span><span class="p">[</span><span class="mi">13</span><span class="p">,:]</span><span class="o">+</span><span class="n">vals</span><span class="p">[</span><span class="mi">14</span><span class="p">,:]))</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">vals</span><span class="p">[</span><span class="mi">13</span><span class="p">,:]</span><span class="o">+</span><span class="n">vals</span><span class="p">[</span><span class="mi">14</span><span class="p">,:]))</span>
    <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;horizontal&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">estSNR</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;SNR&#39;</span><span class="p">)</span>
        <span class="n">SNR</span> <span class="o">=</span> <span class="n">Nelec</span><span class="o">/</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">Nelec</span><span class="o">+</span><span class="n">npix</span><span class="o">*</span><span class="n">pixnoise</span><span class="p">))</span>
        <span class="k">print</span> <span class="s2">&quot;Expected SNR:&quot;</span><span class="p">,</span><span class="n">SNR</span>
        <span class="k">print</span> <span class="s2">&quot;Estimated SNR:&quot;</span><span class="p">,</span><span class="n">estSNR_central</span>
        <span class="k">print</span> <span class="s2">&quot;Change:&quot;</span><span class="p">,</span><span class="mi">100</span><span class="o">*</span><span class="p">(</span><span class="n">SNR</span><span class="o">-</span><span class="n">estSNR_central</span><span class="p">)</span><span class="o">/</span><span class="n">SNR</span><span class="p">,</span><span class="s2">&quot;%&quot;</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">vals</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Extraction results&#39;</span><span class="p">)</span>

        <span class="k">print</span> <span class="s1">&#39;Mean:&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">vals</span><span class="p">[</span><span class="mi">13</span><span class="p">,:]</span><span class="o">+</span><span class="n">vals</span><span class="p">[</span><span class="mi">14</span><span class="p">,:]))</span>
        <span class="k">print</span> <span class="s1">&#39;Std:&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">vals</span><span class="p">[</span><span class="mi">13</span><span class="p">,:]</span><span class="o">+</span><span class="n">vals</span><span class="p">[</span><span class="mi">14</span><span class="p">,:]))</span>
    <span class="k">return</span> <span class="n">estSNR_central</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [198]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="n">subim</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">psflet_subarr</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">calcSNROptExt</span><span class="p">(</span><span class="n">Nelec</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
        <span class="n">subim</span><span class="o">=</span><span class="n">subim</span><span class="p">,</span>
        <span class="n">pixnoise</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">npix</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span>
        <span class="n">plot</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Expected SNR: 31.6227766017
Estimated SNR: 31.2107892037
Change: 1.30281854503 %
Mean: 549.900953784
Std: 17.6189378037
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>Out[198]:
</pre></div>
</div>
<div class="output_area highlight-none"><div class="highlight"><pre>
<span></span>array([  0.27040382,   2.14276031,   8.13595503,  16.05282627,
        19.98479726,  20.46354341,  20.64617222,  20.76131422,
        21.20873272,  21.03647236,  21.63223922,  21.15233367,
        21.38052993,  21.92690443,  21.83935768,  22.18571597,
        21.91702882,  22.32115096,  22.01193149,  22.58144857,
        20.97975538,  16.01598351,   8.53553894,   2.89301963,   0.58626053])
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_SNR_Extraction_51_2.png" src="../_images/notebooks_SNR_Extraction_51_2.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_SNR_Extraction_51_3.png" src="../_images/notebooks_SNR_Extraction_51_3.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_SNR_Extraction_51_4.png" src="../_images/notebooks_SNR_Extraction_51_4.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [207]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="n">noiselist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1000</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span>  <span class="c1"># mean number of electrons from background</span>
<span class="n">estvals</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">compvals</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">npix</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">Nelec</span><span class="o">=</span><span class="mi">300</span>
<span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">noiselist</span><span class="p">:</span>
<span class="c1">#     subim = psflet_subarr[4]</span>
    <span class="n">subim</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">psflet_subarr</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">estSNR</span> <span class="o">=</span> <span class="n">calcSNROptExt</span><span class="p">(</span><span class="n">Nelec</span><span class="o">=</span><span class="n">Nelec</span><span class="p">,</span>
        <span class="n">subim</span><span class="o">=</span><span class="n">subim</span><span class="p">,</span>
        <span class="n">pixnoise</span><span class="o">=</span><span class="n">val</span><span class="p">,</span>
        <span class="n">npix</span><span class="o">=</span><span class="n">npix</span><span class="p">,</span>
        <span class="n">plot</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    <span class="n">estvals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">estSNR</span><span class="p">)</span>
    <span class="n">compvals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Nelec</span><span class="o">/</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">Nelec</span><span class="o">+</span><span class="n">npix</span><span class="o">*</span><span class="n">val</span><span class="p">)))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Optimal extraction&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">noiselist</span><span class="p">,</span><span class="n">estvals</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;Simulated&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Number of additive noise electrons per pixel&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;SNR&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">noiselist</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">compvals</span><span class="p">),</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Expected with npix=</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">npix</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>Out[207]:
</pre></div>
</div>
<div class="output_area highlight-none"><div class="highlight"><pre>
<span></span>[&lt;matplotlib.lines.Line2D at 0x1c1771bad0&gt;]
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_SNR_Extraction_52_1.png" src="../_images/notebooks_SNR_Extraction_52_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [208]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Optimal extraction&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">noiselist</span><span class="p">,</span><span class="n">estvals</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;Simulated&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Number of additive noise electrons per pixel&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;SNR&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">noiselist</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">compvals</span><span class="p">),</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Expected with npix=</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">npix</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>Out[208]:
</pre></div>
</div>
<div class="output_area highlight-none"><div class="highlight"><pre>
<span></span>&lt;matplotlib.legend.Legend at 0x1c16e93190&gt;
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_SNR_Extraction_53_1.png" src="../_images/notebooks_SNR_Extraction_53_1.png" />
</div>
</div>
<div class="section" id="Test-with-Richardson-Lucy-deconvolution">
<h2>Test with Richardson-Lucy deconvolution<a class="headerlink" href="#Test-with-Richardson-Lucy-deconvolution" title="Permalink to this headline"></a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [177]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="c1"># subim = psflet_subarr[3]+psflet_subarr[4]+psflet_subarr[5]</span>
<span class="c1"># sumpsflets = psflet_subarr[3]+psflet_subarr[4]+psflet_subarr[5]+1e-10</span>
<span class="kn">from</span> <span class="nn">crispy.tools.reduction</span> <span class="kn">import</span> <span class="n">RL</span>
<span class="k">def</span> <span class="nf">calcSNR_RL</span><span class="p">(</span><span class="n">Nelec</span><span class="p">,</span><span class="n">subim</span><span class="p">,</span><span class="n">psflet_subarr</span><span class="p">,</span><span class="n">pixnoise</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">npix</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">Niter</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span><span class="n">plot</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="n">sumpsflets</span> <span class="o">=</span> <span class="n">subim</span><span class="o">*</span><span class="n">Nelec</span><span class="o">+</span><span class="n">pixnoise</span><span class="o">+</span><span class="mf">1e-10</span>
    <span class="n">vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">10</span><span class="p">,</span><span class="n">Niter</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Niter</span><span class="p">):</span>
        <span class="c1"># subtract mean of background (assumed known)</span>
        <span class="n">img</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">poisson</span><span class="p">(</span><span class="n">subim</span><span class="o">*</span><span class="n">Nelec</span><span class="p">)</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">poisson</span><span class="p">(</span><span class="n">pixnoise</span><span class="p">,</span><span class="n">subim</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span><span class="o">-</span><span class="n">pixnoise</span>
<span class="c1">#         subim_flat = np.reshape(img/np.sqrt(sumpsflets), -1)</span>
<span class="c1">#         psflets_flat = np.reshape(psflet_subarr, (psflet_subarr.shape[0], -1))</span>
<span class="c1">#         sumpsflets_flat = np.reshape(sumpsflets,-1)</span>
<span class="c1">#         vals[:,i] = np.linalg.lstsq(psflets_flat.T/(np.sqrt(sumpsflets_flat[:,np.newaxis])), subim_flat)[0]</span>
        <span class="n">vals</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">RL</span><span class="p">(</span><span class="n">img</span><span class="p">,</span><span class="n">psflets</span><span class="o">=</span><span class="n">psflet_subarr</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">estSNR</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">vals</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">vals</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;horizontal&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">estSNR</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;SNR&#39;</span><span class="p">)</span>
        <span class="n">SNR</span> <span class="o">=</span> <span class="n">Nelec</span><span class="o">/</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">Nelec</span><span class="o">+</span><span class="n">npix</span><span class="o">*</span><span class="n">pixnoise</span><span class="p">))</span>
        <span class="k">print</span> <span class="s2">&quot;Expected SNR:&quot;</span><span class="p">,</span><span class="n">SNR</span>
        <span class="k">print</span> <span class="s2">&quot;Estimated SNR:&quot;</span><span class="p">,</span><span class="n">estSNR</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
        <span class="k">print</span> <span class="s2">&quot;Change:&quot;</span><span class="p">,</span><span class="mi">100</span><span class="o">*</span><span class="p">(</span><span class="n">SNR</span><span class="o">-</span><span class="n">estSNR</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span><span class="o">/</span><span class="n">SNR</span><span class="p">,</span><span class="s2">&quot;%&quot;</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">vals</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Extraction results&#39;</span><span class="p">)</span>

        <span class="k">print</span> <span class="s1">&#39;Mean:&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">vals</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
        <span class="k">print</span> <span class="s1">&#39;Std:&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">vals</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">estSNR</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [178]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="n">subim</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">psflet_subarr</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">calcSNR_RL</span><span class="p">(</span><span class="n">Nelec</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
        <span class="n">subim</span><span class="o">=</span><span class="n">subim</span><span class="p">,</span>
        <span class="n">psflet_subarr</span><span class="o">=</span><span class="n">psflet_subarr</span><span class="p">,</span>
        <span class="n">pixnoise</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">npix</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
        <span class="n">plot</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Expected SNR: 31.6227766017
Estimated SNR: 16.3542561444
Change: 48.2833011459 %
Mean: 1000.03944128
Std: 61.1485739525
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>Out[178]:
</pre></div>
</div>
<div class="output_area highlight-none"><div class="highlight"><pre>
<span></span>array([ 25.29353844,  19.03189105,  17.99034366,  17.26681037,
        16.35425614,  15.38258849,  14.89139398,  14.27061078,
        14.59881942,  21.86956021])
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_SNR_Extraction_56_2.png" src="../_images/notebooks_SNR_Extraction_56_2.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_SNR_Extraction_56_3.png" src="../_images/notebooks_SNR_Extraction_56_3.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_SNR_Extraction_56_4.png" src="../_images/notebooks_SNR_Extraction_56_4.png" />
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [371]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">crispy.tools.reduction</span> <span class="kn">import</span> <span class="n">RL</span>
<span class="kn">from</span> <span class="nn">crispy.tools.reduction</span> <span class="kn">import</span> <span class="n">calculateWaveList</span>
<span class="n">par</span><span class="o">.</span><span class="n">nchanperspec_lstsq</span> <span class="o">=</span> <span class="mf">1.</span>
<span class="k">def</span> <span class="nf">calcSNRtotal</span><span class="p">(</span><span class="n">Nelec</span><span class="p">,</span><span class="n">subim</span><span class="p">,</span><span class="n">psflet_subarr</span><span class="p">,</span><span class="n">pixnoise</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span><span class="n">npix</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">Niter</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span><span class="n">plot</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="c1">#sumpsflets = subim*Nelec+pixnoise+1e-10</span>
    <span class="n">lstsq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">10</span><span class="p">,</span><span class="n">Niter</span><span class="p">))</span>
    <span class="n">RLvals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">10</span><span class="p">,</span><span class="n">Niter</span><span class="p">))</span>
    <span class="n">optext</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">subim</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">Niter</span><span class="p">))</span>
    <span class="n">PSFlet_tool</span> <span class="o">=</span> <span class="n">PSFLets</span><span class="p">(</span><span class="n">load</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">infiledir</span><span class="o">=</span><span class="n">par</span><span class="o">.</span><span class="n">wavecalDir</span><span class="p">)</span>
    <span class="n">xindx</span> <span class="o">=</span> <span class="n">PSFlet_tool</span><span class="o">.</span><span class="n">xindx</span>
    <span class="n">yindx</span> <span class="o">=</span> <span class="n">PSFlet_tool</span><span class="o">.</span><span class="n">yindx</span>
    <span class="n">Nmax</span> <span class="o">=</span> <span class="n">PSFlet_tool</span><span class="o">.</span><span class="n">nlam_max</span>
    <span class="n">i</span><span class="o">=</span><span class="n">lensX</span><span class="o">+</span><span class="mi">54</span>
    <span class="n">j</span><span class="o">=</span><span class="n">lensY</span><span class="o">+</span><span class="mi">54</span>
    <span class="n">_x</span> <span class="o">=</span> <span class="n">xindx</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="p">:</span><span class="n">PSFlet_tool</span><span class="o">.</span><span class="n">nlam</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]]</span>
    <span class="n">_y</span> <span class="o">=</span> <span class="n">yindx</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="p">:</span><span class="n">PSFlet_tool</span><span class="o">.</span><span class="n">nlam</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]]</span>
    <span class="n">_lam</span> <span class="o">=</span> <span class="n">PSFlet_tool</span><span class="o">.</span><span class="n">lam_indx</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="p">:</span><span class="n">PSFlet_tool</span><span class="o">.</span><span class="n">nlam</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]]</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">_x</span><span class="o">-</span><span class="n">y0</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">Y</span> <span class="o">=</span> <span class="n">_y</span><span class="o">-</span><span class="n">x0</span>
    <span class="n">Y</span> <span class="o">=</span> <span class="n">Y</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">lam</span> <span class="o">=</span> <span class="n">_lam</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="n">psflets_flat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">psflet_subarr</span><span class="p">,</span> <span class="p">(</span><span class="n">psflet_subarr</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">A</span> <span class="o">=</span> <span class="n">psflets_flat</span><span class="o">.</span><span class="n">T</span>
<span class="c1">#     variance = np.reshape(subim*Nelec+pixnoise+1e-10,-1)</span>
<span class="c1">#     Ninv = np.linalg.inv(np.diag(variance))</span>
<span class="c1">#     Cinv = np.dot(np.transpose(A),np.dot(Ninv,A))</span>
<span class="c1">#     C = np.linalg.inv(Cinv)</span>
<span class="c1">#     Q = sp.linalg.sqrtm(Cinv)</span>
<span class="c1">#     s = np.sum(Q,axis=1)</span>
<span class="c1">#     R = Q/s[np.newaxis,:]</span>
<span class="c1">#     Ctilde_inv = np.diag(s**2)</span>
<span class="c1">#     Ctilde = np.dot(np.dot(R,C),R.T)</span>

    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Niter</span><span class="p">):</span>
        <span class="c1"># subtract mean of background (assumed known)</span>
<span class="c1">#         img = np.random.poisson(subim*Nelec)+np.random.poisson(pixnoise,subim.shape)-pixnoise</span>
        <span class="n">Niter</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">amax</span><span class="p">((</span><span class="n">subim</span><span class="o">*</span><span class="n">Nelec</span><span class="o">+</span><span class="n">pixnoise</span><span class="p">)</span><span class="o">/</span><span class="mf">0.1</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        <span class="n">img</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">subim</span><span class="p">)</span>
        <span class="n">var</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">subim</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Niter</span><span class="p">):</span>
            <span class="n">frame</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">poisson</span><span class="p">((</span><span class="n">subim</span><span class="o">*</span><span class="n">Nelec</span><span class="o">+</span><span class="n">pixnoise</span><span class="p">)</span><span class="o">/</span><span class="n">Niter</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">))</span>
            <span class="n">img</span><span class="o">+=</span> <span class="n">frame</span>
            <span class="n">var</span> <span class="o">+=</span> <span class="n">frame</span><span class="o">**</span><span class="mi">2</span>
        <span class="n">var</span> <span class="o">/=</span> <span class="n">Niter</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">var</span> <span class="o">-=</span> <span class="p">(</span><span class="n">img</span><span class="o">/</span><span class="n">Niter</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span>
        <span class="n">var</span><span class="o">*=</span><span class="n">Niter</span>
        <span class="n">img</span> <span class="o">-=</span> <span class="n">pixnoise</span>
<span class="c1">#         subim_flat = np.reshape(img/np.sqrt(sumpsflets), -1)</span>
<span class="c1">#         psflets_flat = np.reshape(psflet_subarr, (psflet_subarr.shape[0], -1))</span>
<span class="c1">#         sumpsflets_flat = np.reshape(sumpsflets,-1)</span>
<span class="c1">#         vals[:,i] = np.linalg.lstsq(psflets_flat.T/(np.sqrt(sumpsflets_flat[:,np.newaxis])), subim_flat)[0]</span>
<span class="c1">#         variance = np.reshape(img+pixnoise+1,-1)</span>
        <span class="n">variance</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">subim</span><span class="o">*</span><span class="n">Nelec</span><span class="o">+</span><span class="n">pixnoise</span><span class="o">+</span><span class="mf">1e-10</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="c1">#         variance = np.reshape(var+1,-1)</span>
        <span class="n">Ninv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">variance</span><span class="p">))</span>
        <span class="n">Cinv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">A</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Ninv</span><span class="p">,</span><span class="n">A</span><span class="p">))</span>
        <span class="n">C</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">Cinv</span><span class="p">)</span>
        <span class="n">Q</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">sqrtm</span><span class="p">(</span><span class="n">Cinv</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">Q</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">R</span> <span class="o">=</span> <span class="n">Q</span><span class="o">/</span><span class="n">s</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,:]</span>
        <span class="n">Ctilde_inv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">s</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">img</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">right</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">A</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Ninv</span><span class="p">,</span><span class="n">x</span><span class="p">))</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">C</span><span class="p">,</span><span class="n">right</span><span class="p">)</span>
        <span class="n">lstsq</span><span class="p">[:,</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">R</span><span class="p">,</span><span class="n">f</span><span class="p">)</span>
        <span class="n">RLvals</span><span class="p">[:,</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">R</span><span class="p">,</span><span class="n">RL</span><span class="p">(</span><span class="n">img</span><span class="p">,</span><span class="n">psflets</span><span class="o">=</span><span class="n">psflet_subarr</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">spec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">subim</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">sig</span> <span class="o">=</span> <span class="mf">2.</span><span class="o">/</span><span class="mf">2.35</span><span class="o">*</span><span class="n">lam</span><span class="o">/</span><span class="n">par</span><span class="o">.</span><span class="n">FWHMlam</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">Y</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
            <span class="n">weights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">-</span><span class="n">y</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="mf">2.</span><span class="o">/</span><span class="n">sig</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="n">sig</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
            <span class="n">optext</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">img</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">weights</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">weights</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>


    <span class="n">estSNRlstsq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">lstsq</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">lstsq</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">estSNRRL</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">RLvals</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">RLvals</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">estSNROptExt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">optext</span><span class="p">[</span><span class="mi">13</span><span class="p">,:]</span><span class="o">+</span><span class="n">optext</span><span class="p">[</span><span class="mi">14</span><span class="p">,:]))</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">optext</span><span class="p">[</span><span class="mi">13</span><span class="p">,:]</span><span class="o">+</span><span class="n">optext</span><span class="p">[</span><span class="mi">14</span><span class="p">,:]))</span>
    <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;horizontal&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">img</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">A</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">R</span><span class="p">,</span><span class="n">f</span><span class="p">)),</span><span class="n">subim</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;horizontal&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
        <span class="n">lamlist</span><span class="p">,</span><span class="n">_</span> <span class="o">=</span> <span class="n">calculateWaveList</span><span class="p">(</span><span class="n">par</span><span class="p">,</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;lstsq&#39;</span><span class="p">)</span>
        <span class="n">lamlist</span><span class="p">,</span><span class="n">_</span> <span class="o">=</span> <span class="n">calculateWaveList</span><span class="p">(</span><span class="n">par</span><span class="p">,</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;lstsq&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lamlist</span><span class="p">,</span><span class="n">lstsq</span><span class="p">[:,</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lamlist</span><span class="p">,</span><span class="n">RLvals</span><span class="p">[:,</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">lamlist</span><span class="p">,</span><span class="n">_</span> <span class="o">=</span> <span class="n">calculateWaveList</span><span class="p">(</span><span class="n">par</span><span class="p">,</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;optext&#39;</span><span class="p">)</span>
        <span class="n">scale</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">RLvals</span><span class="p">[:,</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">optext</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lamlist</span><span class="p">,</span><span class="n">scale</span><span class="o">*</span><span class="n">optext</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">print</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">RLvals</span><span class="p">[:,</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">optext</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

<span class="c1">#         plt.figure()</span>
<span class="c1">#         plt.plot(estSNRlstsq)</span>
<span class="c1">#         plt.plot(estSNRRL)</span>
<span class="c1">#         plt.plot(estSNROptExt)</span>
<span class="c1">#         plt.title(&#39;SNR&#39;)</span>
        <span class="n">SNR</span> <span class="o">=</span> <span class="n">Nelec</span><span class="o">/</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">Nelec</span><span class="o">+</span><span class="n">npix</span><span class="o">*</span><span class="n">pixnoise</span><span class="p">))</span>
        <span class="k">print</span> <span class="s2">&quot;Expected SNR:&quot;</span><span class="p">,</span><span class="n">SNR</span>
        <span class="k">print</span> <span class="s2">&quot;Estimated SNR lstsq:&quot;</span><span class="p">,</span><span class="n">estSNRlstsq</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
        <span class="k">print</span> <span class="s2">&quot;Estimated SNR RL:&quot;</span><span class="p">,</span><span class="n">estSNRRL</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
        <span class="k">print</span> <span class="s2">&quot;Estimated SNR OptExt:&quot;</span><span class="p">,</span><span class="n">estSNROptExt</span>
        <span class="k">print</span> <span class="s2">&quot;Expected mean:&quot;</span><span class="p">,</span><span class="n">Nelec</span>
        <span class="k">print</span> <span class="s2">&quot;Estimated mean:&quot;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">lstsq</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)[</span><span class="mi">4</span><span class="p">]</span>
        <span class="k">print</span> <span class="s2">&quot;Estimated mean:&quot;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">RLvals</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)[</span><span class="mi">4</span><span class="p">]</span>
        <span class="k">print</span> <span class="s2">&quot;Estimated mean:&quot;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">optext</span><span class="p">[</span><span class="mi">13</span><span class="p">,:]</span><span class="o">+</span><span class="n">optext</span><span class="p">[</span><span class="mi">14</span><span class="p">,:]))</span>

<span class="c1">#         plt.figure()</span>
<span class="c1">#         plt.plot(vals[4])</span>
<span class="c1">#         plt.title(&#39;Extraction results&#39;)</span>

<span class="c1">#         print &#39;Mean:&#39;,np.mean(vals[4])</span>
<span class="c1">#         print &#39;Std:&#39;,np.std(vals[4])</span>
    <span class="k">return</span> <span class="n">estSNRlstsq</span><span class="p">,</span><span class="n">estSNRRL</span><span class="p">,</span><span class="n">estSNROptExt</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [372]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="n">subim</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">psflet_subarr</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">subim</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">psflet_subarr</span><span class="o">*</span><span class="n">vect</span><span class="p">[:,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">calcSNRtotal</span><span class="p">(</span><span class="n">Nelec</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
        <span class="n">subim</span><span class="o">=</span><span class="n">subim</span><span class="p">,</span>
        <span class="n">psflet_subarr</span><span class="o">=</span><span class="n">psflet_subarr</span><span class="p">,</span>
        <span class="n">pixnoise</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
        <span class="n">npix</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
        <span class="n">plot</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
        <span class="n">Niter</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
crispy - INFO - Reduced cube will have 10 wavelength bins
crispy - INFO - Reduced cube will have 10 wavelength bins
crispy - INFO - Reduced cube will have 19 wavelength bins
504.200000002 270.427961443
Expected SNR: 31.6148738709
Estimated SNR lstsq: 28.7241519754
Estimated SNR RL: 27.0171184082
Estimated SNR OptExt: 17.3440744592
Expected mean: 1000
Estimated mean: 623.439946174
Estimated mean: 623.38923182
Estimated mean: 210.494672769
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>Out[372]:
</pre></div>
</div>
<div class="output_area highlight-none"><div class="highlight"><pre>
<span></span>(array([ 28.2121054 ,  18.19983961,  25.12328164,  20.55660973,
         28.72415198,  19.37088763,  30.26151529,  18.73784101,
         27.18905131,  17.41781101]),
 array([ 25.27122904,  17.19441798,  25.04029604,  18.77668908,
         27.01711841,  17.30833943,  27.58681473,  17.24006159,
         21.99300259,   8.50430892]),
 17.344074459247068)
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_SNR_Extraction_58_2.png" src="../_images/notebooks_SNR_Extraction_58_2.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_SNR_Extraction_58_3.png" src="../_images/notebooks_SNR_Extraction_58_3.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_SNR_Extraction_58_4.png" src="../_images/notebooks_SNR_Extraction_58_4.png" />
</div>
</div>
<div class="section" id="TODO:-Use-a-finer-sampling-for-the-least-squares-(regenerate-the-polychrome)">
<h3>TODO: Use a finer sampling for the least squares (regenerate the polychrome)<a class="headerlink" href="#TODO:-Use-a-finer-sampling-for-the-least-squares-(regenerate-the-polychrome)" title="Permalink to this headline"></a></h3>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><h3>Page Contents</h3>
<ul>
<li><a class="reference internal" href="#">Here we try to calculate the overlap fraction of two neighboring PSFs</a><ul>
<li><a class="reference internal" href="#Test-with-Richardson-Lucy-deconvolution">Test with Richardson-Lucy deconvolution</a><ul>
<li><a class="reference internal" href="#TODO:-Use-a-finer-sampling-for-the-least-squares-(regenerate-the-polychrome)">TODO: Use a finer sampling for the least squares (regenerate the polychrome)</a></li>
</ul>
</li>
</ul>
</li>
</ul>


        </div>
      </div>
      <div class="clearer"></div>
    </div>
<footer class="footer">
  <p class="pull-right">
    <a href="../_sources/notebooks/SNR Extraction.ipynb.txt"
       rel="nofollow">Page Source</a> &nbsp;
    <a href="#">Back to Top</a></p>
  <p>
    &copy; Copyright 2017, Maxime J. Rizzo.<br/>
    Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.6.3. &nbsp;
    Last built 02 Mar 2018. <br/>
  </p>
</footer>
  </body>
</html>